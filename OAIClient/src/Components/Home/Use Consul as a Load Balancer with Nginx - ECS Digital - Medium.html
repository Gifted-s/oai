<!DOCTYPE html>
<!-- saved from url=(0084)https://medium.com/ecs-digital/use-consul-as-a-load-balancer-with-nginx-b1f6f887677d -->
<html lang="en" data-rh="lang"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/branch-latest.min.js.download"></script><script async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/analytics.js.download"></script><script>!function(c,f){var t,o,i,e=[],r={passive:!0,capture:!0},n=new Date,a="pointerup",u="pointercancel";function p(n,e){t||(t=e,o=n,i=new Date,w(f),s())}function s(){0<=o&&o<i-n&&(e.forEach(function(n){n(o,t)}),e=[])}function l(n){if(n.cancelable){var e=(1e12<n.timeStamp?new Date:performance.now())-n.timeStamp;"pointerdown"==n.type?function(n,e){function t(){p(n,e),i()}function o(){i()}function i(){f(a,t,r),f(u,o,r)}c(a,t,r),c(u,o,r)}(e,n):p(e,n)}}function w(e){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(n){e(n,l,r)})}w(c),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(n){e.push(n),s()}}(addEventListener,removeEventListener)</script><script defer="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/16180790160.js.download"></script><title>Use Consul as a Load Balancer with Nginx - ECS Digital - Medium</title><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta data-rh="true" name="theme-color" content="#000000"><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"><meta data-rh="true" property="al:ios:app_name" content="Medium"><meta data-rh="true" property="al:ios:app_store_id" content="828256236"><meta data-rh="true" property="al:android:package" content="com.medium.reader"><meta data-rh="true" property="fb:app_id" content="542599432471018"><meta data-rh="true" property="og:site_name" content="Medium"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2018-06-26T17:19:06.327Z"><meta data-rh="true" name="title" content="Use Consul as a Load Balancer with Nginx - ECS Digital - Medium"><meta data-rh="true" property="og:title" content="Use Consul as a Load Balancer with Nginx"><meta data-rh="true" property="twitter:title" content="Use Consul as a Load Balancer with Nginx"><meta data-rh="true" name="twitter:site" content="@ECS_Digi"><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/b1f6f887677d"><meta data-rh="true" property="al:android:url" content="medium://p/b1f6f887677d"><meta data-rh="true" property="al:ios:url" content="medium://p/b1f6f887677d"><meta data-rh="true" property="al:android:app_name" content="Medium"><meta data-rh="true" name="description" content="Using Docker, Nginx, Registrator and Consul Template, you will explore part of what Consul can do andload-balance the traffic to two Nginx webservers using an Nginx load balancer."><meta data-rh="true" property="og:description" content="In this post, we will see what Consul can do in terms of Service Discovery, Health Checking, and see how we can use its Key/Value store."><meta data-rh="true" property="twitter:description" content="In this post, we will see what Consul can do in terms of Service Discovery, Health Checking, and see how we can use its Key/Value store."><meta data-rh="true" property="og:url" content="https://medium.com/ecs-digital/use-consul-as-a-load-balancer-with-nginx-b1f6f887677d"><meta data-rh="true" property="al:web:url" content="https://medium.com/ecs-digital/use-consul-as-a-load-balancer-with-nginx-b1f6f887677d"><meta data-rh="true" property="og:image" content="https://miro.medium.com/max/706/1*pzSrge2ZrWvEwXPdpEvUwA.png"><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/max/706/1*pzSrge2ZrWvEwXPdpEvUwA.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="article:author" content="https://medium.com/@micheldlebeau"><meta data-rh="true" name="twitter:creator" content="@micheldlebeau"><meta data-rh="true" name="author" content="Michel Lebeau"><meta data-rh="true" name="robots" content="index,follow"><meta data-rh="true" name="referrer" content="unsafe-url"><meta data-rh="true" name="twitter:label1" value="Reading time"><meta data-rh="true" name="twitter:data1" value="10 min read"><meta data-rh="true" name="parsely-post-id" content="b1f6f887677d"><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://medium.com/osd.xml"><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png"><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png"><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png"><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png"><link data-rh="true" rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/m2.css"><link data-rh="true" rel="author" href="https://medium.com/@micheldlebeau"><link data-rh="true" rel="canonical" href="https://medium.com/ecs-digital/use-consul-as-a-load-balancer-with-nginx-b1f6f887677d"><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/b1f6f887677d"><link data-rh="true" rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico"><script data-rh="true">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-24232453-2', 'auto');
ga('send', 'pageview');</script><link rel="preload" href="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/16180790160.js.download" as="script"><style type="text/css" data-fela-rehydration="509" data-fela-type="STATIC">html{box-sizing:border-box}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}@-moz-keyframes k1{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}@keyframes k1{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}@-webkit-keyframes k2{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@-moz-keyframes k2{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@keyframes k2{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@-webkit-keyframes k3{0%{transform:matrix(0.97, 0, 0, 1, 0, 12);opacity:0}20%{transform:matrix(0.99, 0, 0, 1, 0, 2);opacity:0.7}40%{transform:matrix(1, 0, 0, 1, 0, -1);opacity:1}70%{transform:matrix(1, 0, 0, 1, 0, 0);opacity:1}100%{transform:matrix(1, 0, 0, 1, 0, 0);opacity:1}}@-moz-keyframes k3{0%{transform:matrix(0.97, 0, 0, 1, 0, 12);opacity:0}20%{transform:matrix(0.99, 0, 0, 1, 0, 2);opacity:0.7}40%{transform:matrix(1, 0, 0, 1, 0, -1);opacity:1}70%{transform:matrix(1, 0, 0, 1, 0, 0);opacity:1}100%{transform:matrix(1, 0, 0, 1, 0, 0);opacity:1}}@keyframes k3{0%{transform:matrix(0.97, 0, 0, 1, 0, 12);opacity:0}20%{transform:matrix(0.99, 0, 0, 1, 0, 2);opacity:0.7}40%{transform:matrix(1, 0, 0, 1, 0, -1);opacity:1}70%{transform:matrix(1, 0, 0, 1, 0, 0);opacity:1}100%{transform:matrix(1, 0, 0, 1, 0, 0);opacity:1}}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{height:100vh}.m{width:100vw}.n{display:flex}.o{align-items:center}.p{justify-content:center}.q{fill:rgba(0, 0, 0, 0.84)}.r{display:block}.s{position:absolute}.t{top:0}.u{left:0}.v{right:0}.w{z-index:500}.x{box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.05)}.ag{max-width:1192px}.ah{min-width:0}.ai{width:100%}.aj{height:65px}.am{flex:1 0 auto}.an{visibility:hidden}.ao{margin-left:16px}.ap{display:none}.ar{color:rgba(28, 153, 99, 1)}.as{fill:rgba(2, 184, 117, 1)}.at{font-size:inherit}.au{border:inherit}.av{font-family:inherit}.aw{letter-spacing:inherit}.ax{font-weight:inherit}.ay{padding:0}.az{margin:0}.ba:hover{cursor:pointer}.bb:hover{color:rgba(11, 59, 40, 1)}.bc:hover{fill:rgba(28, 153, 99, 1)}.bd:focus{outline:none}.be:disabled{cursor:default}.bf:disabled{color:rgba(140, 93, 255, 0.5)}.bg:disabled{fill:rgba(140, 93, 255, 0.5)}.bh{flex:0 0 auto}.bi{font-family:medium-content-sans-serif-font, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Arial, sans-serif}.bj{font-style:normal}.bk{line-height:20px}.bl{font-size:15.8px}.bm{letter-spacing:0px}.bn{color:rgba(0, 0, 0, 0.54)}.bo{fill:rgba(0, 0, 0, 0.54)}.bp{justify-content:flex-end}.bq{margin-top:16px}.br{margin-bottom:16px}.bs{display:inherit}.bt{max-width:210px}.bu{text-overflow:ellipsis}.bv{overflow:hidden}.bw{white-space:nowrap}.bx{display:inline-block}.by{border:none}.bz{outline:none}.ca{font:inherit}.cb{font-size:16px}.cc{opacity:0}.cd{position:relative}.ce{width:0px}.cf{transition:width 140ms ease-in}.cg{color:inherit}.ch{fill:inherit}.ci:hover{color:rgba(0, 0, 0, 0.9)}.cj:hover{fill:rgba(0, 0, 0, 0.9)}.ck:disabled{color:rgba(0, 0, 0, 0.54)}.cl:disabled{fill:rgba(0, 0, 0, 0.54)}.cm{margin-right:10px}.cq{margin-right:16px}.cr{margin:15px 0}.cs{padding:4px 12px}.ct{color:rgba(0, 0, 0, 0.84)}.cu{background:0}.cv{border-color:rgba(0, 0, 0, 0.54)}.cw:hover{color:rgba(0, 0, 0, 0.97)}.cx:hover{fill:rgba(0, 0, 0, 0.97)}.cy:hover{border-color:rgba(0, 0, 0, 0.84)}.cz:disabled{fill:rgba(0, 0, 0, 0.76)}.da:disabled{border-color:rgba(0, 0, 0, 0.2)}.db:disabled{cursor:inherit}.dc:disabled:hover{color:rgba(0, 0, 0, 0.54)}.dd:disabled:hover{fill:rgba(0, 0, 0, 0.76)}.de:disabled:hover{border-color:rgba(0, 0, 0, 0.2)}.df{border-radius:4px}.dg{border-width:1px}.dh{border-style:solid}.di{box-sizing:border-box}.dj{text-decoration:none}.dk{padding-bottom:10px}.dl{padding-top:10px}.dm{border-radius:50%}.dn{height:32px}.do{width:32px}.dp{border-top:1px solid rgba(0, 0, 0, 0.1)}.dq{height:54px}.dr{margin-right:40px}.ds{height:36px}.dt{width:89px}.du{overflow:auto}.dv{flex:0 1 auto}.dw{list-style-type:none}.dx{line-height:40px}.dy{overflow-x:auto}.dz{align-items:flex-start}.ea{margin-top:20px}.eb{padding-top:20px}.ec{height:80px}.ed{height:20px}.ee{margin-right:15px}.ef{margin-left:15px}.eg:first-child{margin-left:0}.eh{min-width:1px}.ei{background-color:rgba(0, 0, 0, 0.34)}.ej{font-weight:300}.ek{font-size:15px}.el{text-transform:uppercase}.em{letter-spacing:1px}.en{margin-bottom:0px}.eo{height:119px}.er{padding-left:24px}.es{padding-right:24px}.et{margin-left:auto}.eu{margin-right:auto}.ev{max-width:728px}.ew{flex-direction:column}.ex{top:calc(100vh + 100px)}.ey{bottom:calc(100vh + 100px)}.ez{width:10px}.fa{pointer-events:none}.fb{word-break:break-word}.fc{word-wrap:break-word}.fd:after{display:block}.fe:after{content:""}.ff:after{clear:both}.fg{max-width:680px}.fh{line-height:1.23}.fi{letter-spacing:0}.fj{font-family:medium-content-title-font, Georgia, Cambria, "Times New Roman", Times, serif}.fu{margin-bottom:-0.27em}.ga{margin-top:32px}.gb{justify-content:space-between}.gf{height:48px}.gg{width:48px}.gh{margin-left:12px}.gi{margin-bottom:2px}.gk{max-height:20px}.gl{display:-webkit-box}.gm{-webkit-line-clamp:1}.gn{-webkit-box-orient:vertical}.go:hover{text-decoration:underline}.gp{margin-left:8px}.gq{padding:0px 8px}.gr{border-color:rgba(2, 184, 117, 1)}.gs:hover{border-color:rgba(28, 153, 99, 1)}.gt{line-height:18px}.gu{align-items:flex-end}.hc{padding-right:6px}.hd{margin-right:8px}.he{fill:rgba(0, 0, 0, 0.76)}.hf{margin-right:-6px}.hg{clear:both}.hm{transition:opacity 100ms 400ms}.hn{height:100%}.ho{will-change:transform}.hp{transform:translateZ(0)}.hq{margin:auto}.hr{background-color:rgba(0, 0, 0, 0.05)}.hs{padding-bottom:41.199606686332345%}.ht{height:0}.hu{filter:blur(20px)}.hv{transform:scale(1.1)}.hw{visibility:visible}.hx{background:rgba(255, 255, 255, 1)}.hy{margin-top:10px}.hz{text-align:center}.ic{line-height:1.58}.id{letter-spacing:-0.004em}.ie{font-family:medium-content-serif-font, Georgia, Cambria, "Times New Roman", Times, serif}.ip{margin-bottom:-0.46em}.iq{letter-spacing:-0.003em}.iw{background-repeat:repeat-x}.ix{background-image:linear-gradient(to right,rgba(0, 0, 0, 0.84) 100%,rgba(0, 0, 0, 0.84) 0);background-image:url('data:image/svg+xml;utf8,<svg preserveAspectRatio="none" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="0" x2="1" y2="1" stroke="rgba(0, 0, 0, 0.84)" /></svg>')}.iy{background-size:1px 1px}.iz{background-position:0 1.05em;background-position:0 calc(1em + 1px)}.jf{box-shadow:0 1px 4px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.jg{padding:0px}.jh{padding:16px 20px}.ji{flex:1 1 auto}.jk{font-weight:600}.jl{font-size:18px}.jm{max-height:40px}.jn{-webkit-line-clamp:2}.jo{margin-top:8px}.jp{margin-top:12px}.jq{width:160px}.jr{background-image:url(https://miro.medium.com/max/320/0*OAnb7sHCTJWe3vUM.)}.js{background-origin:border-box}.jt{background-size:cover}.ju{height:167px}.jv{background-position:50% 50%}.jw{max-width:100%}.jx{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.jy{line-height:1.12}.jz{letter-spacing:-0.022em}.ki{margin-bottom:-0.28em}.kj{line-height:1.18}.ku{margin-bottom:-0.31em}.kv{box-shadow:inset 3px 0 0 0 rgba(0, 0, 0, 0.84)}.kw{padding-left:23px}.kx{margin-left:-20px}.ky{font-style:italic}.kz{font-weight:700}.la{padding:2px 4px}.lb{font-size:75%}.lc> strong{font-family:inherit}.ld{font-family:Menlo, Monaco, "Courier New", Courier, monospace}.le{max-width:706px}.lf{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}.lg{cursor:zoom-in}.lh{z-index:auto}.li{padding-bottom:64.02266288951841%}.lo{padding:20px}.lp{background:rgba(0, 0, 0, 0.05)}.lq{margin-top:-0.09em}.lr{margin-bottom:-0.09em}.ls{white-space:pre-wrap}.lt{list-style-type:disc}.lu{margin-left:30px}.lv{padding-left:0px}.mb{list-style-type:decimal}.mk{max-width:2444px}.ml{padding-bottom:5px}.mm{padding-top:5px}.mn{padding-bottom:6.137479541734861%}.mo{max-width:2058px}.mp{padding-bottom:52.08940719144801%}.mq{will-change:opacity}.mr{position:fixed}.ms{width:188px}.mt{left:50%}.mu{transform:translateX(406px)}.mv{top:calc(65px + 54px + 14px)}.my{top:calc(65px + 54px + 40px)}.na{width:131px}.nb{padding-bottom:28px}.nc{border-bottom:1px solid rgba(0, 0, 0, 0.1)}.nd{padding-bottom:20px}.ne{padding-top:2px}.nf{max-height:120px}.ng{-webkit-line-clamp:6}.nh{padding-top:28px}.ni{margin-bottom:19px}.nj{margin-left:-3px}.np{outline:0}.nq{border:0}.nr{user-select:none}.ns{cursor:pointer}.nt> svg{pointer-events:none}.nu:active{border-style:none}.nv{-webkit-user-select:none}.nw:focus{fill:rgba(0, 0, 0, 0.54)}.nx:hover{fill:rgba(0, 0, 0, 0.54)}.of button{text-align:left}.og{margin-top:40px}.oh{flex-wrap:wrap}.oi{margin-top:25px}.oj{margin-bottom:8px}.ok{border-radius:3px}.ol{padding:5px 10px}.om{line-height:22px}.on{margin-top:15px}.oo{flex-direction:row}.op{max-width:155px}.ov{border:1px solid rgba(0, 0, 0, 0.1)}.ow{height:60px}.ox{width:60px}.pk:hover{border-color:rgba(0, 0, 0, 0.54)}.pl:active{border-style:solid}.pm{z-index:2}.po{top:1px}.pu{padding-right:8px}.pv{padding-top:32px}.pw{margin-bottom:25px}.py{margin-bottom:32px}.pz{min-height:80px}.qe{width:80px}.qf{padding-left:102px}.qh{letter-spacing:0.05em}.qi{margin-bottom:6px}.qj{font-size:28px}.qk{line-height:36px}.ql{max-width:555px}.qm{max-width:450px}.qn{line-height:24px}.qp{max-width:550px}.qq{padding-top:25px}.qt{color:rgba(0, 0, 0, 0.76)}.qu{opacity:1}.qv{border:1px solid rgba(2, 184, 117, 1)}.qw{margin-top:64px}.qx{background-color:rgba(0, 0, 0, 0.02)}.qy{padding:60px 0}.qz{background-color:rgba(0, 0, 0, 0.9)}.rq{padding-bottom:48px}.rr{border-bottom:1px solid rgba(255, 255, 255, 0.54)}.rs{margin:0 -12px}.rt{margin:0 12px}.ru{flex:1 1 0}.rv{padding-bottom:12px}.rw:hover{color:rgba(255, 255, 255, 0.99)}.rx:hover{fill:rgba(255, 255, 255, 0.99)}.ry:disabled{color:rgba(255, 255, 255, 0.7)}.rz:disabled{fill:rgba(255, 255, 255, 0.7)}.sa{color:rgba(255, 255, 255, 0.98)}.sb{fill:rgba(255, 255, 255, 0.98)}.sc{text-align:inherit}.sd{font-size:21.6px}.se{letter-spacing:-0.32px}.sf{color:rgba(255, 255, 255, 0.7)}.sg{fill:rgba(255, 255, 255, 0.7)}.sh{text-decoration:underline}.si{padding-bottom:8px}.sj{padding-top:8px}.sk{width:200px}.sq:disabled{color:rgba(3, 168, 124, 0.5)}.sr:disabled{fill:rgba(3, 168, 124, 0.5)}.ss{background-image:url(https://miro.medium.com/max/160/0*OAnb7sHCTJWe3vUM.)}.st{-webkit-user-select:none}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.af{margin:0 64px}.fs{font-size:40px}.ft{margin-top:0.78em}.fz{line-height:48px}.hb{margin-left:30px}.hl{margin-top:56px}.in{font-size:21px}.io{margin-top:2em}.iv{line-height:32px}.je{margin-top:32px}.kg{font-size:34px}.kh{margin-top:1.95em}.ks{font-size:26px}.kt{margin-top:1.72em}.ln{margin-top:0.86em}.ma{margin-top:1.05em}.mj{max-width:1192px}.no{margin-right:5px}.oe{margin-top:5px}.ou{margin-right:16px}.pt{width:25px}.rn{padding-left:64px}.ro{padding-right:64px}.rp{max-width:1320px}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.ha{margin-left:30px}.ia{margin-left:auto}.ib{text-align:center}.nn{margin-right:5px}.od{margin-top:5px}.ot{margin-right:16px}.ps{width:25px}.rk{padding-left:64px}.rl{padding-right:64px}.rm{max-width:1080px}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.cp{display:flex}.gz{margin-left:30px}.nm{margin-right:5px}.oc{margin-top:5px}.os{margin-right:16px}.pr{width:15px}.rh{padding-left:48px}.ri{padding-right:48px}.rj{max-width:904px}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.ak{height:56px}.al{display:flex}.aq{display:block}.cn{margin-left:10px}.co{margin-right:10px}.ep{margin-bottom:0px}.eq{height:110px}.gd{margin-top:32px}.ge{flex-direction:column-reverse}.gx{margin-bottom:30px}.gy{margin-left:0px}.jj{padding:10px 12px 10px}.nl{margin-left:8px}.oa{margin-top:2px}.ob{margin-right:8px}.or{margin-left:16px}.pq{width:15px}.px{padding-top:32px}.qa{margin-bottom:24px}.qb{align-items:center}.qc{width:102px}.qd{position:relative}.qg{padding-left:0}.qo{margin-top:24px}.qr{padding-top:25px}.qs{border-top:1px solid rgba(0, 0, 0, 0.1)}.ra{padding:32px 0}.re{padding-left:24px}.rf{padding-right:24px}.rg{max-width:728px}.sl{width:140px}.sm{margin-bottom:16px}.sn{margin-top:30px}.so{width:100%}.sp{flex-direction:row}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.z{margin:0 24px}.fk{font-size:30px}.fl{margin-top:0.72em}.fv{line-height:40px}.gc{margin-top:32px}.gj{margin-bottom:0px}.gv{margin-bottom:30px}.gw{margin-left:0px}.hh{margin-top:40px}.if{font-size:18px}.ig{margin-top:1.56em}.ir{line-height:28px}.ja{margin-top:24px}.ka{margin-top:1.2em}.kk{font-size:24px}.kl{margin-top:1.23em}.lj{margin-top:0.67em}.lw{margin-top:1.34em}.mc{margin:0}.md{max-width:100%}.nk{margin-left:8px}.ny{margin-top:2px}.nz{margin-right:8px}.oq{margin-left:16px}.pp{width:15px}.rb{padding-left:24px}.rc{padding-right:24px}.rd{max-width:552px}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.ae{margin:0 64px}.fq{font-size:40px}.fr{margin-top:0.78em}.fy{line-height:48px}.hk{margin-top:56px}.il{font-size:21px}.im{margin-top:2em}.iu{line-height:32px}.jd{margin-top:32px}.ke{font-size:34px}.kf{margin-top:1.95em}.kq{font-size:26px}.kr{margin-top:1.72em}.lm{margin-top:0.86em}.lz{margin-top:1.05em}.mi{max-width:1192px}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.ac{margin:0 48px}.fo{font-size:40px}.fp{margin-top:0.78em}.fx{line-height:48px}.hj{margin-top:56px}.ij{font-size:21px}.ik{margin-top:2em}.it{line-height:32px}.jc{margin-top:32px}.kc{font-size:34px}.kd{margin-top:1.95em}.ko{font-size:26px}.kp{margin-top:1.72em}.ll{margin-top:0.86em}.ly{margin-top:1.05em}.mg{margin:0}.mh{max-width:100%}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.ab{margin:0 24px}.fm{font-size:30px}.fn{margin-top:0.72em}.fw{line-height:40px}.hi{margin-top:40px}.ih{font-size:18px}.ii{margin-top:1.56em}.is{line-height:28px}.jb{margin-top:24px}.kb{margin-top:1.2em}.km{font-size:24px}.kn{margin-top:1.23em}.lk{margin-top:0.67em}.lx{margin-top:1.34em}.me{margin:0}.mf{max-width:100%}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="print">.y{display:none}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.mw{transition:opacity 200ms}.oy{transition:border-color 150ms ease}.oz::before{background:
      radial-gradient(circle, rgba(0, 0, 0, 0.84) 60%, transparent 70%)
    }.pa::before{border-radius:50%}.pb::before{content:""}.pc::before{display:block}.pd::before{z-index:0}.pe::before{left:0}.pf::before{height:100%}.pg::before{position:absolute}.ph::before{top:0}.pi::before{width:100%}.pj:hover::before{animation:k2 2000ms infinite cubic-bezier(.1,.12,.25,1)}.pn{transition:fill 200ms ease}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (max-width: 1230px)">.mx{display:none}</style><style type="text/css" data-fela-rehydration="509" data-fela-type="RULE" media="all and (max-width: 1198px)">.mz{display:none}</style><script type="application/ld+json" data-rh="true">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F1200\u002F1*pzSrge2ZrWvEwXPdpEvUwA.png"],"url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fuse-consul-as-a-load-balancer-with-nginx-b1f6f887677d","dateCreated":"2017-10-25T12:03:51.430Z","datePublished":"2017-10-25T12:03:51.430Z","dateModified":"2018-06-26T17:19:06.327Z","headline":"Use Consul as a Load Balancer with Nginx - ECS Digital - Medium","name":"Use Consul as a Load Balancer with Nginx - ECS Digital - Medium","description":"Using Docker, Nginx, Registrator and Consul Template, you will explore part of what Consul can do andload-balance the traffic to two Nginx webservers using an Nginx load balancer.","identifier":"b1f6f887677d","keywords":["Lite:true","Tag:Hashicorp Consul","Tag:DevOps","Tag:Docker","Tag:Tools","Tag:Tutorial","Topic:Programming","Publication:ecs-digital","Elevated:false","LockedPostSource:LOCKED_POST_SOURCE_NONE","LayerCake:0"],"author":{"@type":"Person","name":"Michel Lebeau","url":"https:\u002F\u002Fmedium.com\u002F@micheldlebeau"},"creator":["Michel Lebeau"],"publisher":{"@type":"Organization","name":"ECS Digital","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital","logo":{"@type":"ImageObject","width":149,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F149\u002F1*f-XKiuRAmuxnZHQNh85Szg.png"}},"mainEntityOfPage":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fuse-consul-as-a-load-balancer-with-nginx-b1f6f887677d"}</script><script type="text/javascript" data-rh="true">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0);
branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {metadata: {}, 'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true, 'tracking_disabled': null}, function(err, data) {});</script><link rel="stylesheet" id="coToolbarStyle" href="chrome-extension://bejnhdlplbjhffionohbdnpcbobfejcc/toolbar/styles/placeholder.css" type="text/css"><script type="text/javascript" id="cosymantecbfw_removeToolbar">(function () {				var toolbarElement = {},					parent = {},					interval = 0,					retryCount = 0,					isRemoved = false;				if (window.location.protocol === 'file:') {					interval = window.setInterval(function () {						toolbarElement = document.getElementById('coFrameDiv');						if (toolbarElement) {							parent = toolbarElement.parentNode;							if (parent) {								parent.removeChild(toolbarElement);								isRemoved = true;								if (document.body && document.body.style) {									document.body.style.setProperty('margin-top', '0px', 'important');								}							}						}						retryCount += 1;						if (retryCount > 10 || isRemoved) {							window.clearInterval(interval);						}					}, 10);				}			})();</script><script type="text/javascript" async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/_r"></script><script type="text/javascript" async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/_r(1)"></script><script type="text/javascript" async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/_r(2)"></script><script type="text/javascript" async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/_r(3)"></script><script type="text/javascript" async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/_r(4)"></script><script type="text/javascript" async="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/_r(5)"></script></head><body data-gr-c-s-loaded="true"><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><script>if (window.self !== window.top) window.top.location = window.self.location.href</script><script>window.PARSELY = window.PARSELY || {autotrack: false}</script><nav class="r s t u v c w x y"><div><div class="r c"><div class="n p"><div class="z ab ac ae af ag ah ai"><div class="aj n o ak al"><div class="n o am w"><a href="https://medium.com/?source=post_page-----b1f6f887677d----------------------" aria-label="Homepage" rel="noopener"><svg width="35" height="35" viewBox="5 5 35 35" class="q"><path d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.69-.32 1.03L10.8 31.4v.4h6.97v-.4L15.3 28.4c-.29-.34-.34-.5-.34-1.03v-8.95l6.13 13.36h.71l5.26-13.36v10.64c0 .3 0 .35-.19.53l-1.85 1.8v.4h9.2v-.4l-1.83-1.8c-.18-.18-.2-.24-.2-.53V15.94c0-.3.02-.35.2-.53l1.82-1.8v-.4h-6.47l-4.62 11.55-5.2-11.54h-6.8v.4l2.15 2.63c.24.3.29.37.29.77v10.35z"></path></svg></a><div class="hw" id="li-general-navbar-open-in-app-button"><div class="ao ap aq"><a href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fb1f6f887677d&amp;~feature=LiMobileNavBar&amp;~channel=ShowPostUnderCollection&amp;source=post_page-----b1f6f887677d----------------------" class="ar as at au av aw ax ay az ba bb bc bd be bf bg" rel="noopener nofollow">Open in app</a></div></div></div><div class="r bh w"><span class="bi b bj bk bl bm r bn bo"><div class="n o bp"><div class="n f"><div class="bx" aria-hidden="true"><div class="n"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25" class="ao cm r cn co"><path d="M20.07 18.93l-4.16-4.15a6 6 0 1 0-.88.88l4.15 4.16a.62.62 0 1 0 .89-.89zM6.5 11a4.75 4.75 0 1 1 9.5 0 4.75 4.75 0 0 1-9.5 0z"></path></svg></button><input class="by bz ca cb bk cc cd ce cf" placeholder="Search ECS Digital" value=""></div></div></div><div class="ap cp"><a href="https://medium.com/search?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener"><svg width="25" height="25" viewBox="0 0 25 25" class="ao cq r cn co"><path d="M20.07 18.93l-4.16-4.15a6 6 0 1 0-.88.88l4.15 4.16a.62.62 0 1 0 .89-.89zM6.5 11a4.75 4.75 0 1 1 9.5 0 4.75 4.75 0 0 1-9.5 0z"></path></svg></a></div><a class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener" href="https://medium.com/me/list/queue?source=post_page-----b1f6f887677d----------------------"><svg width="25" height="25" viewBox="0 0 25 25" class="cq r g"><path d="M16 6a2 2 0 0 1 2 2v13.66h-.01a.5.5 0 0 1-.12.29.5.5 0 0 1-.7.03l-5.67-4.13-5.66 4.13a.5.5 0 0 1-.7-.03.48.48 0 0 1-.13-.29H5V8c0-1.1.9-2 2-2h9zM6 8v12.64l5.16-3.67a.49.49 0 0 1 .68 0L17 20.64V8a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"></path><path d="M21 5v13.66h-.01a.5.5 0 0 1-.12.29.5.5 0 0 1-.7.03l-.17-.12V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1H8c0-1.1.9-2 2-2h9a2 2 0 0 1 2 2z"></path></svg></a><div class="cq n co"><div class="bx" aria-hidden="true"><button class="sw hq sx sy sz gr ta gs ba db tb tc td te bi b bj bk bl bm tf dg dh di bx dj bd">1</button></div></div><div class="hw" id="li-post-page-navbar-upsell-button"><div class="cq r g"><div><a href="https://medium.com/membership?source=upgrade_membership---nav_full------------------------" class="cs ct q cu cv cw cx cy ba ck cz da db dc dd de df bi b bj bk bl bm dg dh di bx dj bd" rel="noopener">Upgrade</a></div></div></div><div class="n" aria-hidden="true"><div class="dk dl n o"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><img alt="Adewumi Sunkanmi" class="r dm dn do" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_dmbNkD5D-u45r44go_cf0g.png" width="32" height="32"></button></div></div></div></span></div></div></div></div></div><div class="dp r c aq"><div class="n p"><div class="z ab ac ae af ag ah ai"><div class="dq bv n o"><div class="dr r bh"><a href="https://medium.com/ecs-digital?source=post_page-----b1f6f887677d----------------------" rel="noopener"><div class="ds dt r"><img alt="ECS Digital" class="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_f-XKiuRAmuxnZHQNh85Szg.png" width="89" height="36"></div></a></div><div class="du r dv"><ul class="dw az dx bw dy n dz g ea eb ec"><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://medium.com/ecs-digital/devops/home?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">DevOps</a></span></li><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://medium.com/ecs-digital/testing/home?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">Testing</a></span></li><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://medium.com/ecs-digital/tools/home?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">Tools</a></span></li><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://medium.com/ecs-digital/cloud/home?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">Cloud</a></span></li><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://medium.com/ecs-digital/culture/home?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">Culture</a></span></li><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://medium.com/ecs-digital/tutorials/home?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">Tutorials</a></span></li><span class="ed eh ei"></span><li class="n o ed ee ef eg"><span class="bi ej ek bk bn el em"><a href="https://www.ecs-digital.co.uk/?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener nofollow">ECS Digital Website</a></span></li></ul></div></div></div></div></div></div></nav><div class="en eo r ep eq"></div><article><section class="er es et eu ai ev di n ew"></section><span class="r"></span><div><div class="s u ex ey ez fa"></div><section class="fb fc fd fe ff"><div class="n p"><div class="z ab ac ae af fg ah ai"><div><div id="38e8" class="fh fi ct bj fj b fk fl fm fn fo fp fq fr fs ft fu"><h1 class="fj b fk fv fm fw fo fx fq fy fs fz ct">Use Consul as a Load Balancer with Nginx</h1></div><div class="ga"><div class="n gb gc gd ge"><div class="o n"><div><a rel="noopener" href="https://medium.com/@micheldlebeau?source=post_page-----b1f6f887677d----------------------"><img alt="Michel Lebeau" class="r dm gf gg" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_yVci1FgEH8nXLw8LjDvRAg.png" width="48" height="48"></a></div><div class="gh ai r"><div class="n"><div style="flex:1"><span class="bi b bj bk bl bm r ct q"><div class="gi n o gj"><span class="bi ej cb bk bv gk bu gl gm gn ct"><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/@micheldlebeau?source=post_page-----b1f6f887677d----------------------">Michel Lebeau</a></span><div class="gp r bh h"><button class="gq cu ar as gr bb bc gs ba df bi b bj gt ek bm dg dh di bx dj bd">Follow</button></div></div></span></div></div><span class="bi b bj bk bl bm r bn bo"><span class="bi ej cb bk bv gk bu gl gm gn bn"><div><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/ecs-digital/use-consul-as-a-load-balancer-with-nginx-b1f6f887677d?source=post_page-----b1f6f887677d----------------------">Oct 25, 2017</a> <!-- -->·<!-- --> <!-- -->10<!-- --> min read</div></span></span></div></div><div class="n gu gv gw gx gy gz ha hb y"><div class="n o"><div class="hc r bh"><a href="https://medium.com/p/b1f6f887677d/share/twitter?source=post_actions_header---------------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div><div class="hc r bh"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="29" height="29" viewBox="0 0 29 29" fill="none" class="q"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></button></div><div class="hc r bh"><a href="https://medium.com/p/b1f6f887677d/share/facebook?source=post_actions_header---------------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div><div class="hd r"><div><div class="he"><div><div class="bx" role="tooltip" aria-hidden="true" aria-describedby="1" aria-labelledby="1"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div><div class="hf r am"><div class="bx" aria-hidden="true"><div class="bx" aria-hidden="true"><div class="r bh"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="-480.5 272.5 21 21" class="q"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></button></div></div></div></div></div></div></div></div></div></div></div><div class="hg ai"><figure class="hh hi hj hk hl hg ai paragraph-image"><div class="hq r cd hr"><div class="hs ht r"><div class="cc hm s t u hn ai bv ho hp"><img class="s t u hn ai hu hv an tg" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_a-WTOYRFLAzdJeO9QZhqGA.png" width="1017" height="419" role="presentation"></div><img class="qu su s t u hn ai hx" width="1017" height="419" srcset="https://miro.medium.com/max/552/1*a-WTOYRFLAzdJeO9QZhqGA.png 276w, https://miro.medium.com/max/1104/1*a-WTOYRFLAzdJeO9QZhqGA.png 552w, https://miro.medium.com/max/1280/1*a-WTOYRFLAzdJeO9QZhqGA.png 640w, https://miro.medium.com/max/1456/1*a-WTOYRFLAzdJeO9QZhqGA.png 728w, https://miro.medium.com/max/1632/1*a-WTOYRFLAzdJeO9QZhqGA.png 816w, https://miro.medium.com/max/1808/1*a-WTOYRFLAzdJeO9QZhqGA.png 904w, https://miro.medium.com/max/1984/1*a-WTOYRFLAzdJeO9QZhqGA.png 992w, https://miro.medium.com/max/2034/1*a-WTOYRFLAzdJeO9QZhqGA.png 1017w" sizes="1017px" role="presentation" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_a-WTOYRFLAzdJeO9QZhqGA(1).png"><noscript><img class="s t u hn ai" src="https://miro.medium.com/max/2034/1*a-WTOYRFLAzdJeO9QZhqGA.png" width="1017" height="419" srcSet="https://miro.medium.com/max/552/1*a-WTOYRFLAzdJeO9QZhqGA.png 276w, https://miro.medium.com/max/1104/1*a-WTOYRFLAzdJeO9QZhqGA.png 552w, https://miro.medium.com/max/1280/1*a-WTOYRFLAzdJeO9QZhqGA.png 640w, https://miro.medium.com/max/1456/1*a-WTOYRFLAzdJeO9QZhqGA.png 728w, https://miro.medium.com/max/1632/1*a-WTOYRFLAzdJeO9QZhqGA.png 816w, https://miro.medium.com/max/1808/1*a-WTOYRFLAzdJeO9QZhqGA.png 904w, https://miro.medium.com/max/1984/1*a-WTOYRFLAzdJeO9QZhqGA.png 992w, https://miro.medium.com/max/2034/1*a-WTOYRFLAzdJeO9QZhqGA.png 1017w" sizes="1017px" role="presentation"/></noscript></div></div><figcaption class="hy hz ev et eu ia ib bi ej cb bk bn" data-selectable-paragraph="">Consul’s Logo</figcaption></figure></div><div class="n p"><div class="z ab ac ae af fg ah ai"><p id="3f1c" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">In this post, we will see what Consul can do in terms of Service Discovery, Health Checking, and see how we can use its Key/Value store. We will create two nginx servers, serving two different pages. These pages will display keys from the K/V store of Consul using Consul Template. We will then dynamically load balance these two servers with a third Nginx server, which will only send traffic to the servers that are online. This will all rely heavily on Docker, and Registrator will be used to automatically (de-)register our services.</p><p id="41e7" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">This blog post is derived from a <a href="https://www.meetup.com/DevOpsPlayground/events/243881875/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">meetup</a> I presented in London a week ago, which I help run with my company, <a href="https://www.ecs-digital.co.uk/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">ECS Digital</a>. This is usually hands-on, and every gets a chance to learn something practical.</p><div class="ja jb jc jd je jf"><a href="https://www.meetup.com/DevOpsPlayground/" target="_blank" rel="noopener nofollow"><div class="jg n bh"><div class="jh n ew p ji jj"><h2 class="bi jk jl bk bv jm bu gl jn gn ct">DevOps Playground</h2><div class="jo r"><h3 class="bi ej cb bk bv jm bu gl jn gn bn">Interested in DevOps? Confused about all the concept and tools out there? Our meetup group aims to provide some…</h3></div><div class="jp r"><h4 class="bi ej ek bk bv jm bu gl jn gn bn">www.meetup.com</h4></div></div><div class="jq r"><div class="jr r js jt ju jq jv jw jx"></div></div></div></a></div><h1 id="18ba" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">The theory</h1><h2 id="c5f4" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph=""><a href="http://consul.io/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Consul</a></h2><blockquote class="kv kw kx"><p id="29d4" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Consul has multiple components, but as a whole, it is a tool for discovering and configuring services in your infrastructure. It provides several key features:</p><p id="184b" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><strong class="ie kz">* Service Discovery</strong>: Clients of Consul can <em class="bj">provide</em> a service, such as <code class="hr la lb lc ld b">api</code> or <code class="hr la lb lc ld b">mysql</code>, and other clients can use Consul to <em class="bj">discover</em> providers of a given service. Using either DNS or HTTP, applications can easily find the services they depend upon.</p><p id="0989" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><strong class="ie kz">* Health Checking</strong>: Consul clients can provide any number of health checks, either associated with a given service (“is the webserver returning 200 OK”), or with the local node (“is memory utilization below 90%”). This information can be used by an operator to monitor cluster health, and it is used by the service discovery components to route traffic away from unhealthy hosts.</p><p id="ab73" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><strong class="ie kz">* KV Store</strong>: Applications can make use of Consul’s hierarchical key/value store for any number of purposes, including dynamic configuration, feature flagging, coordination, leader election, and more. The simple HTTP API makes it easy to use.</p><p id="36ca" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><strong class="ie kz">* Multi Datacenter</strong>: Consul supports multiple datacenters out of the box. This means users of Consul do not have to worry about building additional layers of abstraction to grow to multiple regions.</p><p id="8db1" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Consul is designed to be friendly to both the DevOps community and application developers, making it perfect for modern, elastic infrastructures.</p></blockquote><p id="d3c1" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><a href="https://www.consul.io/intro/index.html" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Taken directly from the official documentation</a>, which is worth reading. <br>We will make use of the Service Discovery, Health Checking and KV Store.</p><h2 id="2ea5" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Nginx</h2><blockquote class="kv kw kx"><p id="092d" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">NGINX is a free, open-source, high-performance HTTP server and reverse proxy, as well as an IMAP/POP3 proxy server. NGINX is known for its high performance, stability, rich feature set, simple configuration, and low resource consumption.</p></blockquote><p id="be17" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><a href="https://www.nginx.com/resources/wiki/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Taken from the official Wiki</a>, we will use two Nginx containers to run as webservers, serving simple HTML pages, and we will run a third Nginx container as a load-balancer, to forward requests to the two webservers, or only the ones that are online.</p><h2 id="e4ff" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Consul Template</h2><blockquote class="kv kw kx"><p id="63de" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">This project provides a convenient way to populate values from <a href="https://www.consul.io/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Consul</a> into the file system using the <code class="hr la lb lc ld b">consul-template</code> daemon.</p><p id="fc44" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">The daemon <code class="hr la lb lc ld b">consul-template</code> queries a <a href="https://www.consul.io/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Consul</a> or <a href="https://www.vaultproject.io/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Vault</a> cluster and updates any number of specified templates on the file system. As an added bonus, it can optionally run arbitrary commands when the update process completes.</p></blockquote><p id="b058" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><a href="https://github.com/hashicorp/consul-template" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">From the readme</a>, we will use Consul Template to render the static HTML pages that will be served by the two Nginx webservers.</p><h2 id="53e5" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Registrator</h2><blockquote class="kv kw kx"><p id="7c03" class="ic iq ct ky ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Registrator automatically registers and deregisters services for any Docker container by inspecting containers as they come online. Registrator supports pluggable service registries, which currently includes <a href="http://www.consul.io/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">Consul</a>, <a href="https://github.com/coreos/etcd" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">etcd</a> and <a href="https://github.com/skynetservices/skydns/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">SkyDNS 2</a>.</p></blockquote><p id="e439" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><a href="http://gliderlabs.github.io/registrator/latest/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">From the documentation</a>, made by GliderLabs, a group of devs creating cool and useful tools. Registrator will take care of registering our webserver services as they come online, and de-registering them as they go offline, automatically.</p><figure class="hh hi hj hk hl hg et eu paragraph-image"><div class="lf lg cd lh ai"><div class="et eu le"><div class="hq r cd hr"><div class="li ht r"><div class="cc hm s t u hn ai bv ho hp"><img class="s t u hn ai hu hv an tg" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_pzSrge2ZrWvEwXPdpEvUwA.png" width="706" height="452" role="presentation"></div><img class="qu su s t u hn ai hx" width="706" height="452" srcset="https://miro.medium.com/max/552/1*pzSrge2ZrWvEwXPdpEvUwA.png 276w, https://miro.medium.com/max/1104/1*pzSrge2ZrWvEwXPdpEvUwA.png 552w, https://miro.medium.com/max/1280/1*pzSrge2ZrWvEwXPdpEvUwA.png 640w, https://miro.medium.com/max/1400/1*pzSrge2ZrWvEwXPdpEvUwA.png 700w" sizes="700px" role="presentation" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_pzSrge2ZrWvEwXPdpEvUwA(1).png"><noscript><img class="s t u hn ai" src="https://miro.medium.com/max/1412/1*pzSrge2ZrWvEwXPdpEvUwA.png" width="706" height="452" srcSet="https://miro.medium.com/max/552/1*pzSrge2ZrWvEwXPdpEvUwA.png 276w, https://miro.medium.com/max/1104/1*pzSrge2ZrWvEwXPdpEvUwA.png 552w, https://miro.medium.com/max/1280/1*pzSrge2ZrWvEwXPdpEvUwA.png 640w, https://miro.medium.com/max/1400/1*pzSrge2ZrWvEwXPdpEvUwA.png 700w" sizes="700px" role="presentation"/></noscript></div></div></div></div><figcaption class="hy hz ev et eu ia ib bi ej cb bk bn" data-selectable-paragraph="">The infrastructure we will be aiming for</figcaption></figure><h1 id="1903" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Where to run this?</h1><p id="5810" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">We ran this in an AWS instance, and this blog post will be based on this fact.</p><p id="feb8" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">We used a small instance, but this will run decently on a micro instance, which is in the free tier. We used Ubuntu 16.04 for the OS, and used the defaults for everything else.</p><p id="3792" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">This can run natively on your laptop, however be aware that for example Docker for Mac has <a href="https://docs.docker.com/docker-for-mac/networking/#known-limitations-use-cases-and-workarounds" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">many limitations in terms of networking</a>. Using an AWS instance will give you the easiest experience.</p><h1 id="7d5a" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Before you start…</h1><h2 id="305d" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Install Docker on your AWS instance</h2><p id="2718" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">The first step will be to setup the Docker repository on your machine. You will then be able to install Docker.</p><pre class="hh hi hj hk hl lo lp dy"><span id="bc07" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo apt-get update<br>sudo apt-get -y install \<br>    apt-transport-https \<br>    ca-certificates \<br>    curl \<br>    software-properties-common<br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - <!-- -->&amp;&gt;/dev/null<br>sudo apt-get update<br>sudo apt-get install docker-ce</span></pre><h2 id="6442" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Download the images that you will need later on</h2><p id="58a4" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">We will make use of the official Consul and Nginx images, and will use the registrator image from Gliderlabs, so let’s download them ahead of time.</p><pre class="hh hi hj hk hl lo lp dy"><span id="2189" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo docker pull consul:1.0.0<br>sudo docker pull nginx:1.13.5<br>sudo docker pull gliderlabs/registrator</span></pre><h2 id="38eb" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Download Consul Template</h2><p id="dd99" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">We will use Consul Template to render our templates using keys from Consul’s Key/Value store, so we download Consul Template and install it ahead of time too.</p><pre class="hh hi hj hk hl lo lp dy"><span id="b880" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">wget https://releases.hashicorp.com/consul-template/0.19.3/consul-template_0.19.3_linux_amd64.tgz -O /tmp/consul-template.tar.gz<br>sudo tar -xvzf /tmp/consul-template.tar.gz -C /usr/local/bin</span></pre><p id="c3ed" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">All sorted with the pre-requisites, let’s start.</p><h1 id="dcf0" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Start the Consul Server</h1><pre class="hh hi hj hk hl lo lp dy"><span id="f4eb" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo docker run -d \<br>  --name consul --net=host \<br>  -p 8500:8500 \<br>  -e 'CONSUL_LOCAL_CONFIG={"skip_leave_on_interrupt": true, "ui": true,  "dns_config": { "allow_stale": false }}' \<br>  consul:1.0.0 agent -server -bind="$(curl -s http://169.254.169.254/latest/meta-data/local-ipv4)" -client=0.0.0.0  -bootstrap</span></pre><p id="3f49" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">This will start a new container running Consul, and attach it to the port 8500 of your instance. Your Consul service will be bound to the private IP of your AWS instance, and listen to requests coming from anywhere. A Consul cluster composed of a single server will be bootstrapped.</p><p id="0a1c" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">For the detailed explanations:</p><ul class=""><li id="aab1" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">docker run</code>: run the docker container</li><li id="0634" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-d</code>: daemon mode</li><li id="3750" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">--name consul</code>: give a human friendly name to our container</li><li id="5d29" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">--net=host</code>: use the host's network, will make it easier for our containers to communicate with each other</li><li id="bc4e" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-p 8500:8500</code>: link the port 8500 of our container with the port 8500 of our host, so that we can access the consul ui of our host from outside</li><li id="e6f9" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-e 'CONSUL_LOCAL_CONFIG={"skip_leave_on_interrupt": true, "ui": true, "dns_config": { "allow_stale": false }}'</code>: pass some configuration to consul</li><li id="0863" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">consul</code>: we will use the official consul image</li><li id="4a83" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">agent -server</code>: we then pass options to our image, here we want to run the agent in server mode</li><li id="4734" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-bind="$(curl -s http://169.254.169.254/latest/meta-data/local-ipv4)"</code>: bind the consul server to the private IP of our instance to make it easier for all our containers to talk to each other</li><li id="e769" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-client=0.0.0.0</code>: accept connections from anywhere</li><li id="47c0" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-bootstrap</code>: let the consul server be the only server</li></ul><h1 id="2758" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Start Registrator</h1><pre class="hh hi hj hk hl lo lp dy"><span id="3e77" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo docker run -d \<br>    --name=registrator \<br>    --net=host \<br>    --volume=/var/run/docker.sock:/tmp/docker.sock \<br>    gliderlabs/registrator \<br>      consul://localhost:8500</span></pre><p id="ee85" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">This will start a new container running Registrator, with access to the Docker API, and using Consul to register services.</p><p id="ac6d" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Details:</p><ul class=""><li id="1913" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">--volume=/var/run/docker.sock:/tmp/docker.sock</code>: Allows Registrator to access Docker API</li><li id="0e77" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">gliderlabs/registrator</code>: using gliderlabs’ registrator</li><li id="ecf3" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">consul://localhost:8500</code>: registry URL, in this case Consul</li></ul><h1 id="870e" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Generate your index pages</h1><h2 id="ae96" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Create your templates first</h2><pre class="hh hi hj hk hl lo lp dy"><span id="a9c0" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">echo "Server Nginx 1, Name: {{ keyOrDefault \"playground/server1\" \"server1 name missing\" }}" &gt;&gt; /tmp/index.html.1.template<br>echo "Server Nginx 2, Name: {{ keyOrDefault \"playground/server2\" \"server2 name missing\" }}" &gt;&gt; /tmp/index.html.2.template</span></pre><p id="82d2" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">We create two simple HTML pages, <code class="hr la lb lc ld b">{{ keyOrDefault \"playground/server1\" \"server1 name missing\" }}"</code>: will be replaced by consul-template with the value of the key <code class="hr la lb lc ld b">playground/server1</code>, or will be "server1 name missing" by default if no key with this name is present.</p><h2 id="274d" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Render the templates using Consul Template</h2><pre class="hh hi hj hk hl lo lp dy"><span id="0c6e" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">nohup consul-template \<br>-template "/tmp/index.html.1.template:/tmp/index.html.1:/bin/bash -c 'sudo docker restart nginx || true'" \<br>-template "/tmp/index.html.2.template:/tmp/index.html.2:/bin/bash -c 'sudo docker restart nginx2 || true'" &amp;</span></pre><p id="6889" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">We run consul-template in the background using nohup and pass our two templates. For each template that we want rendered, we pass three things:</p><ol class=""><li id="87f1" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip mb lu lv" data-selectable-paragraph="">the input, our template</li><li id="6808" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip mb lu lv" data-selectable-paragraph="">the output, the rendered html page</li><li id="2f2b" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip mb lu lv" data-selectable-paragraph="">optionally a command that should be run every time one of the keys change</li></ol><p id="6c0c" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Here we render our templates into index.html.1 and index.html.2 to keep track of them easily, and we indicate that the containers that will be linked to them should be restarted if they are re-rendered. This will allow the page to be refreshed easily in the container. We add <code class="hr la lb lc ld b">|| true</code> as our container isn’t running yet, so restarting it is not going to work, but we want consul-template to keep on running nonetheless .</p><h2 id="22f3" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Look at your rendered index pages</h2><pre class="hh hi hj hk hl lo lp dy"><span id="0bd7" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">cat /tmp/index.html.1<br>cat /tmp/index.html.2</span></pre><p id="9d58" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">As you can see, the pages have been rendered by consul-template, but they are using the defaults that you provided in the templates. You will create the keys in a moment.</p><h1 id="1c90" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Start your Nginx web servers</h1><pre class="hh hi hj hk hl lo lp dy"><span id="56a6" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo docker run -d -P --name=nginx -v /tmp/index.html.1:/usr/share/nginx/html/index.html -e "SERVICE_NAME=webserver" nginx:1.13.5<br>sudo docker run -d -P --name=nginx2 -v /tmp/index.html.2:/usr/share/nginx/html/index.html -e "SERVICE_NAME=webserver" nginx:1.13.5</span></pre><p id="5557" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Here we create two containers running nginx, and we give them a service name “webserver” for Registrator.</p><p id="9c4a" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Details:</p><ul class=""><li id="149e" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-P</code>: make any ports used in the container available on the host, but let Docker handle it</li><li id="3209" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-v /tmp/index.html.1:-v /tmp/index.html.1:/usr/share/nginx/html/index.html</code>: mount the <code class="hr la lb lc ld b">/tmp/index.html.1</code> file on our host as <code class="hr la lb lc ld b">/usr/share/nginx/html/index.html</code> in the container, which is the page that will be served by default as the root of the webserver</li><li id="51d7" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">-e "SERVICE_NAME=webserver"</code>: let registrator know that this container is running the service webserver, and it will automatically register it with Consul</li><li id="570c" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">nginx:1.13.5</code>: use the official nginx image version 1.13.5</li></ul><h2 id="8146" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Query your new nginx servers</h2><p id="129d" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">Get the ports on which they are accessible:<br><code class="hr la lb lc ld b">sudo docker ps -f name=nginx</code></p></div></div><div class="hg"><div class="n p"><div class="mc md me mf mg mh ae mi af mj ah ai"><figure class="hh hi hj hk hl hg ml mm paragraph-image"><div class="lf lg cd lh ai"><div class="et eu mk"><div class="hq r cd hr"><div class="mn ht r"><div class="cc hm s t u hn ai bv ho hp"><img class="s t u hn ai hu hv an tg" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_mCvE5hFPsOqmDQfgzl0Now.png" width="2444" height="150" role="presentation"></div><img class="qu su s t u hn ai hx" width="2444" height="150" srcset="https://miro.medium.com/max/552/1*mCvE5hFPsOqmDQfgzl0Now.png 276w, https://miro.medium.com/max/1104/1*mCvE5hFPsOqmDQfgzl0Now.png 552w, https://miro.medium.com/max/1280/1*mCvE5hFPsOqmDQfgzl0Now.png 640w, https://miro.medium.com/max/1456/1*mCvE5hFPsOqmDQfgzl0Now.png 728w, https://miro.medium.com/max/1632/1*mCvE5hFPsOqmDQfgzl0Now.png 816w, https://miro.medium.com/max/1808/1*mCvE5hFPsOqmDQfgzl0Now.png 904w, https://miro.medium.com/max/1984/1*mCvE5hFPsOqmDQfgzl0Now.png 992w, https://miro.medium.com/max/2000/1*mCvE5hFPsOqmDQfgzl0Now.png 1000w" sizes="1000px" role="presentation" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_mCvE5hFPsOqmDQfgzl0Now(1).png"><noscript><img class="s t u hn ai" src="https://miro.medium.com/max/4888/1*mCvE5hFPsOqmDQfgzl0Now.png" width="2444" height="150" srcSet="https://miro.medium.com/max/552/1*mCvE5hFPsOqmDQfgzl0Now.png 276w, https://miro.medium.com/max/1104/1*mCvE5hFPsOqmDQfgzl0Now.png 552w, https://miro.medium.com/max/1280/1*mCvE5hFPsOqmDQfgzl0Now.png 640w, https://miro.medium.com/max/1456/1*mCvE5hFPsOqmDQfgzl0Now.png 728w, https://miro.medium.com/max/1632/1*mCvE5hFPsOqmDQfgzl0Now.png 816w, https://miro.medium.com/max/1808/1*mCvE5hFPsOqmDQfgzl0Now.png 904w, https://miro.medium.com/max/1984/1*mCvE5hFPsOqmDQfgzl0Now.png 992w, https://miro.medium.com/max/2000/1*mCvE5hFPsOqmDQfgzl0Now.png 1000w" sizes="1000px" role="presentation"/></noscript></div></div></div></div></figure></div></div></div><div class="n p"><div class="z ab ac ae af fg ah ai"><p id="8f36" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">This will display your two new nginx containers, and see the port mapping as seen below, where nginx and nginx2 are respectively running on the ports <code class="hr la lb lc ld b">32768</code> and <code class="hr la lb lc ld b">32769</code>.</p><p id="6395" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">You should now be able to query the servers on their respective ports, and see their content:<br><code class="hr la lb lc ld b">curl localhost:32768</code></p><h2 id="6dab" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Create the keys/values in Consul</h2><p id="d729" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">Consul ships with a UI which we activated when we created the Consul server, so let’s use it to create the keys that our templates are looking for.</p><ol class=""><li id="365d" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip mb lu lv" data-selectable-paragraph="">Go to <code class="hr la lb lc ld b">http://&lt;public IP&gt;:8500/ui/</code>, with &lt;public IP&gt; being the public IP of your instance.</li><li id="49d7" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip mb lu lv" data-selectable-paragraph="">In the top menu, click on the KEY/VALUE menu item.</li><li id="be58" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip mb lu lv" data-selectable-paragraph="">In the Create Key box, add the <code class="hr la lb lc ld b">playground/server1</code> key and set its value to the name you want to give to your first server</li><li id="4cf3" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip mb lu lv" data-selectable-paragraph="">Click the Create button</li><li id="1dc4" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip mb lu lv" data-selectable-paragraph="">Repeat steps 2 to 4 for the key <code class="hr la lb lc ld b">playground/server2</code></li></ol></div></div><div class="hg"><div class="n p"><div class="mc md me mf mg mh ae mi af mj ah ai"><figure class="hh hi hj hk hl hg ml mm paragraph-image"><div class="lf lg cd lh ai"><div class="et eu mo"><div class="hq r cd hr"><div class="mp ht r"><div class="cc hm s t u hn ai bv ho hp"><img class="s t u hn ai hu hv an tg" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_cAPpiAvXifrXKl33EgCe7w.png" width="2058" height="1072" role="presentation"></div><img class="qu su s t u hn ai hx" width="2058" height="1072" srcset="https://miro.medium.com/max/552/1*cAPpiAvXifrXKl33EgCe7w.png 276w, https://miro.medium.com/max/1104/1*cAPpiAvXifrXKl33EgCe7w.png 552w, https://miro.medium.com/max/1280/1*cAPpiAvXifrXKl33EgCe7w.png 640w, https://miro.medium.com/max/1456/1*cAPpiAvXifrXKl33EgCe7w.png 728w, https://miro.medium.com/max/1632/1*cAPpiAvXifrXKl33EgCe7w.png 816w, https://miro.medium.com/max/1808/1*cAPpiAvXifrXKl33EgCe7w.png 904w, https://miro.medium.com/max/1984/1*cAPpiAvXifrXKl33EgCe7w.png 992w, https://miro.medium.com/max/2000/1*cAPpiAvXifrXKl33EgCe7w.png 1000w" sizes="1000px" role="presentation" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_cAPpiAvXifrXKl33EgCe7w(1).png"><noscript><img class="s t u hn ai" src="https://miro.medium.com/max/4116/1*cAPpiAvXifrXKl33EgCe7w.png" width="2058" height="1072" srcSet="https://miro.medium.com/max/552/1*cAPpiAvXifrXKl33EgCe7w.png 276w, https://miro.medium.com/max/1104/1*cAPpiAvXifrXKl33EgCe7w.png 552w, https://miro.medium.com/max/1280/1*cAPpiAvXifrXKl33EgCe7w.png 640w, https://miro.medium.com/max/1456/1*cAPpiAvXifrXKl33EgCe7w.png 728w, https://miro.medium.com/max/1632/1*cAPpiAvXifrXKl33EgCe7w.png 816w, https://miro.medium.com/max/1808/1*cAPpiAvXifrXKl33EgCe7w.png 904w, https://miro.medium.com/max/1984/1*cAPpiAvXifrXKl33EgCe7w.png 992w, https://miro.medium.com/max/2000/1*cAPpiAvXifrXKl33EgCe7w.png 1000w" sizes="1000px" role="presentation"/></noscript></div></div></div></div><figcaption class="hy hz ev et eu ia ib bi ej cb bk bn" data-selectable-paragraph="">Consul UI with the two keys created</figcaption></figure></div></div></div><div class="n p"><div class="z ab ac ae af fg ah ai"><h2 id="1a24" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Query the servers again</h2><p id="b7da" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">The port will now have changed, so run <code class="hr la lb lc ld b">sudo docker ps -f name=nginx</code> again to see which ports are in use now.</p><p id="e090" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph=""><code class="hr la lb lc ld b">curl localhost:32770</code> and you should see your keys working! You can change the values of the keys and see the result changing immediately.</p><h1 id="d19f" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Setup the Nginx Load Balancer</h1><h2 id="d375" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Create the nginx.conf template</h2><pre class="hh hi hj hk hl lo lp dy"><span id="9f9b" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">cat &lt;&lt;EOT &gt;&gt; /tmp/nginx.conf.template<br>upstream app {<br>  {{range service "webserver"}}server {{.Address}}:{{.Port}} max_fails=3 fail_timeout=60 weight=1;<br>  {{else}}server 127.0.0.1:65535; # force a 502{{end}}<br>}<br><br>server {<br>  listen 80 default_server;<br>  resolver 172.16.0.23;<br>  set \$upstream_endpoint http://app;<br><br>  location / {<br>    proxy_pass \$upstream_endpoint;<br>    proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;<br>    proxy_set_header Host \$host;<br>    proxy_set_header X-Real-IP \$remote_addr;<br>  }<br>}<br>EOT</span></pre><p id="df08" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">We create a new template which is going to loop over all our services called “webserver” and add them to the list of servers in the upstream of our load balancer, and we then send the traffic to this upstream.</p><p id="426a" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">Here is what happens in details:</p><ul class=""><li id="5243" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">cat &lt;&lt;EOT &gt;&gt; /tmp/nginx.conf.template</code>: will append everything that comes after this line and before the text <code class="hr la lb lc ld b">EOT</code> to the file <code class="hr la lb lc ld b">/tmp/nginx.conf.template</code></li><li id="b86b" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">upstream app { ... }</code>: set the list of servers that can handle requests</li><li id="c0c7" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">{{range service "webserver"}}server {{.Address}}:{{.Port}} max_fails=3 fail_timeout=60 weight=1;</code>: loop over all our services "webserver", effectively our two nginx webservers, and add their address then port to the template</li><li id="715a" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">{{else}}server 127.0.0.1:65535; # force a 502{{end}}</code>: if there is no service called webserver, then our list will be empty, so we do this little trick in order to return a 502 to the user</li><li id="f487" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">server { ... }</code>: configure our server</li><li id="b059" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">listen 80 default_server;</code>: listen on the port 80</li><li id="70f4" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">resolver 172.16.0.23;</code>: set the DNS to be the one from AWS, this is needed for dynamic load balancing</li><li id="76dd" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">set \$upstream_endpoint http://app;</code>: we escape the $ here so that <code class="hr la lb lc ld b">$upstream_endpoint</code> isn't interpreted by bash, and we let nginx know that the upstream endpoint is <a href="http://app/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">http://app</a>, with app being one of the servers defined previously</li><li id="ea3f" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph=""><code class="hr la lb lc ld b">location / { ... }</code>: this block takes care of proxying the details of the requests when the root page is called</li></ul><h2 id="69fa" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Render the nginx.conf file</h2><pre class="hh hi hj hk hl lo lp dy"><span id="5786" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">nohup consul-template -template "/tmp/nginx.conf.template:/tmp/nginx.conf:/bin/bash -c 'sudo docker restart nginx-lb || true'" &amp;</span></pre><p id="3e3d" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">We run consul-template again, taking our template as an input, and generating nginx.conf as an output, and every time it will change, the nginx-lb container, which will contain the nginx load balancer, will be restarted, so that the new configuration can be used.</p><h2 id="341c" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Output the content of nginx.conf</h2><pre class="hh hi hj hk hl lo lp dy"><span id="495f" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">cat /tmp/nginx.conf</span></pre><p id="39c7" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">You can see the content of nginx.conf and see that it was rendered with the two currently running webservers in the upstream servers.</p><h2 id="f8a1" class="kj jz ct bj bi jk kk kl km kn ko kp kq kr ks kt ku" data-selectable-paragraph="">Test the template</h2><pre class="hh hi hj hk hl lo lp dy"><span id="3c08" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo docker stop nginx2</span></pre><p id="5c21" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">For fun, you can stop the nginx2 container, then see that the configuration file will have changed.</p><pre class="hh hi hj hk hl lo lp dy"><span id="125f" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">cat /tmp/nginx.conf</span></pre><p id="0322" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">You can then start the container again</p><pre class="hh hi hj hk hl lo lp dy"><span id="5c2d" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo <!-- -->docker start nginx2</span></pre><p id="179d" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">And see the content of nginx.conf once again</p><pre class="hh hi hj hk hl lo lp dy"><span id="857c" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">cat /tmp/nginx.conf</span></pre><h1 id="7e8b" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Start the load balancer</h1><pre class="hh hi hj hk hl lo lp dy"><span id="0ab9" class="kj jz ct bj ld b cb lq lr r ls" data-selectable-paragraph="">sudo docker run -p 80:80 --name nginx-lb \<br>  -v /tmp/nginx.conf:/etc/nginx/conf.d/default.conf \<br>  -e "SERVICE_TAGS=loadbalancer" -d \<br>  nginx:1.13.5</span></pre><p id="eaf2" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">You can now type your public IP (the one you were given on paper) in your browser and see your page. Here are a few things that you can try:</p><ul class=""><li id="ccbe" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip lt lu lv" data-selectable-paragraph="">Refresh several times, you will see the two pages alternate</li><li id="2dd7" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph="">Change your key values in Consul UI, notice how the text changes in your browser</li><li id="0d60" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph="">Shutdown nginx or nginx2 (or even both!) and see what happens when you refresh your browser. (hint: <code class="hr la lb lc ld b">sudo docker stop nginx</code>, <code class="hr la lb lc ld b">sudo docker start nginx</code>...)</li><li id="6bd3" class="ic iq ct bj ie b if lw ir ih lx is ij ly it il lz iu in ma iv ip lt lu lv" data-selectable-paragraph="">Change your index templates, notice what happens. Can you figure out why?</li></ul><h1 id="8b50" class="jy jz ct bj bi jk fk ka fm kb kc kd ke kf kg kh ki" data-selectable-paragraph="">Author’s notes</h1><p id="1cc3" class="ic iq ct bj ie b if lj ir ih lk is ij ll it il lm iu in ln iv ip fb" data-selectable-paragraph="">This a showcase of what sort of things can be done using Consul, not a production use-case. I encourage you to read through the documentation and other use cases as it can do much more.</p><p id="0aaa" class="ic iq ct bj ie b if ig ir ih ii is ij ik it il im iu in io iv ip fb" data-selectable-paragraph="">I work as a consultant for <a href="https://www.ecs-digital.co.uk/" class="cg dj iw ix iy iz" target="_blank" rel="noopener nofollow">ECS Digital</a> in London mainly with Puppet, HashiCorp, Jenkins and automation in general. Get in touch if you liked what you read, or would like to learn more about our work.</p></div></div></section></div></article><div class="qu fa mq mr ai my mw mz" data-test-id="post-sidebar"><div class="n p"><div class="z ab ac ae af ag ah ai"><div class="na n ew"><div class="sv"><div class="nb nc r"><a href="https://medium.com/ecs-digital?source=post_sidebar--------------------------post_sidebar-" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener"><h2 class="bi jk jl bk ct">ECS Digital</h2></a><div class="nd ne r"><h4 class="bi ej cb bk bv nf bu gl ng gn bn">We transform organisations through #DevOps and…</h4></div><div class="bx" aria-hidden="true"><button class="cs cu ar as gr bb bc gs ba df bi b bj bk bl bm dg dh di bx dj bd">Follow</button></div></div><div class="nh ni nj n"><div class="n o"><div class="r cd nk nl nm nn no"><div class=""><button class="ay np nq nr ns nt nu nv q nw nx"><svg width="29" height="29"><g fill-rule="evenodd"><path d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></button></div></div><div class="r ny nz oa ob oc od oe"><div class="of"><h4 class="bi ej cb bk bn"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl">123 </button></h4></div></div></div></div><div class="ni r"></div><div><div class="he"><div><div class="bx" role="tooltip" aria-hidden="true" aria-describedby="2" aria-labelledby="2"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div><div class="qu sv mq mr ms mt mu mv mw mx"></div><div><div class="og hg n ew p"><div class="n p"><div class="z ab ac ae af fg ah ai"><div class="n oh"></div><div class="n o oh"></div><div class="oi r"><ul class="ay az"><li class="bx dw hd oj"><a href="https://medium.com/tag/hashicorp-consul" class="ok ol dj bn r lp om a b ek">Hashicorp Consul</a></li><li class="bx dw hd oj"><a href="https://medium.com/tag/devops" class="ok ol dj bn r lp om a b ek">DevOps</a></li><li class="bx dw hd oj"><a href="https://medium.com/tag/docker" class="ok ol dj bn r lp om a b ek">Docker</a></li><li class="bx dw hd oj"><a href="https://medium.com/tag/tools" class="ok ol dj bn r lp om a b ek">Tools</a></li><li class="bx dw hd oj"><a href="https://medium.com/tag/tutorial" class="ok ol dj bn r lp om a b ek">Tutorial</a></li></ul></div><div class="on n gb y"><div class="n oo"><div class="op r"><div class="n o"><div class="r cd oq or os ot ou"><div class=""><div class="c ov dm n o ow cd ox oy oz pa pb pc pd pe pf pg ph pi pj pk"><button class="ay np nq nr ns nt pl nv o hx dm n p pm u hn s t ai q nw nx pn"><svg width="33" height="33" viewBox="0 0 33 33"><path d="M28.86 17.34l-3.64-6.4c-.3-.43-.71-.73-1.16-.8a1.12 1.12 0 0 0-.9.21c-.62.5-.73 1.18-.32 2.06l1.22 2.6 1.4 2.45c2.23 4.09 1.51 8-2.15 11.66a9.6 9.6 0 0 1-.8.71 6.53 6.53 0 0 0 4.3-2.1c3.82-3.82 3.57-7.87 2.05-10.39zm-6.25 11.08c3.35-3.35 4-6.78 1.98-10.47L21.2 12c-.3-.43-.71-.72-1.16-.8a1.12 1.12 0 0 0-.9.22c-.62.49-.74 1.18-.32 2.06l1.72 3.63a.5.5 0 0 1-.81.57l-8.91-8.9a1.33 1.33 0 0 0-1.89 1.88l5.3 5.3a.5.5 0 0 1-.71.7l-5.3-5.3-1.49-1.49c-.5-.5-1.38-.5-1.88 0a1.34 1.34 0 0 0 0 1.89l1.49 1.5 5.3 5.28a.5.5 0 0 1-.36.86.5.5 0 0 1-.36-.15l-5.29-5.29a1.34 1.34 0 0 0-1.88 0 1.34 1.34 0 0 0 0 1.89l2.23 2.23L9.3 21.4a.5.5 0 0 1-.36.85.5.5 0 0 1-.35-.14l-3.32-3.33a1.33 1.33 0 0 0-1.89 0 1.32 1.32 0 0 0-.39.95c0 .35.14.69.4.94l6.39 6.4c3.53 3.53 8.86 5.3 12.82 1.35zM12.73 9.26l5.68 5.68-.49-1.04c-.52-1.1-.43-2.13.22-2.89l-3.3-3.3a1.34 1.34 0 0 0-1.88 0 1.33 1.33 0 0 0-.4.94c0 .22.07.42.17.61zm14.79 19.18a7.46 7.46 0 0 1-6.41 2.31 7.92 7.92 0 0 1-3.67.9c-3.05 0-6.12-1.63-8.36-3.88l-6.4-6.4A2.31 2.31 0 0 1 2 19.72a2.33 2.33 0 0 1 1.92-2.3l-.87-.87a2.34 2.34 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.64l-.14-.14a2.34 2.34 0 0 1 0-3.3 2.39 2.39 0 0 1 3.3 0l.14.14a2.33 2.33 0 0 1 3.95-1.24l.09.09c.09-.42.29-.83.62-1.16a2.34 2.34 0 0 1 3.3 0l3.38 3.39a2.17 2.17 0 0 1 1.27-.17c.54.08 1.03.35 1.45.76.1-.55.41-1.03.9-1.42a2.12 2.12 0 0 1 1.67-.4 2.8 2.8 0 0 1 1.85 1.25l3.65 6.43c1.7 2.83 2.03 7.37-2.2 11.6zM13.22.48l-1.92.89 2.37 2.83-.45-3.72zm8.48.88L19.78.5l-.44 3.7 2.36-2.84zM16.5 3.3L15.48 0h2.04L16.5 3.3z" fill-rule="evenodd"></path></svg></button></div></div></div><div class="r ny nz oa ob oc od oe"><div class="cd po of"><h4 class="bi ej cb bk ct"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl">123 claps</button></h4></div></div></div></div><div class="r pp pq pr ps pt"></div></div><div class="n o"><div class="hc r bh"><a href="https://medium.com/p/b1f6f887677d/share/twitter?source=post_actions_footer---------------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div><div class="hc r bh"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="29" height="29" viewBox="0 0 29 29" fill="none" class="q"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></button></div><div class="hc r bh"><a href="https://medium.com/p/b1f6f887677d/share/facebook?source=post_actions_footer---------------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div><div class="pu r bh"><div><div class="he"><div><div class="bx" role="tooltip" aria-hidden="true" aria-describedby="3" aria-labelledby="3"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div><div class="bx" aria-hidden="true"><div class="bx" aria-hidden="true"><div class="r bh"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="-480.5 272.5 21 21" class="q"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></button></div></div></div></div></div><div class="pv dp pw oi r px y"><div class="r aq"><div class="py pz r cd"><span class="r qa al qb"><div class="r s qc qd"><a rel="noopener" href="https://medium.com/@micheldlebeau?source=follow_footer--------------------------follow_footer-"><img alt="Michel Lebeau" class="r dm ec qe" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_yVci1FgEH8nXLw8LjDvRAg(1).png" width="80" height="80"></a></div><span class="r"><div class="qf r qg"><p class="bi ej ek bk bn el qh">Written by</p></div><div class="qf qi n qg"><div class="ai n o gb"><h2 class="bi jk qj qk ct"><a class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener" href="https://medium.com/@micheldlebeau?source=follow_footer--------------------------follow_footer-">Michel Lebeau</a></h2><div class="r g"><button class="cs cu ar as gr bb bc gs ba df bi b bj bk bl bm dg dh di bx dj bd">Follow</button></div></div></div></span></span><div class="qf ql r qg aq"><div class="qm r"><h4 class="bi ej jl qn bn">DevOps and CD Consultant in London at ECS Digital, more links at https://micheldlebeau.com</h4></div><div class="ap qo aq"><button class="cs cu ar as gr bb bc gs ba df bi b bj bk bl bm dg dh di bx dj bd">Follow</button></div></div></div><div class="pv r"></div><div class="py pz r cd"><span class="r qa al qb"><div class="r s qc qd"><a href="https://medium.com/ecs-digital?source=follow_footer--------------------------follow_footer-" rel="noopener"><img alt="ECS Digital" class="df qe ec" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_d1iZ2errdypdhTpO_h-QXQ.png" width="80" height="80"></a></div><span class="r"><div class="qf qi n qg"><div class="ai n o gb"><h2 class="bi jk qj qk ct"><a href="https://medium.com/ecs-digital?source=follow_footer--------------------------follow_footer-" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener">ECS Digital</a></h2><div class="r g"><div class="bx" aria-hidden="true"><button class="cs cu ar as gr bb bc gs ba df bi b bj bk bl bm dg dh di bx dj bd">Follow</button></div></div></div></div></span></span><div class="qf qp r qg aq"><div class="qm r"><h4 class="bi ej jl qn bn">We transform organisations through #DevOps and #ContinuousDelivery by focusing on #PeopleProcessTools. Organiser of #DevOpsPlayground and #AHODevOps meetups.</h4></div><div class="ap qo aq"><div class="bx" aria-hidden="true"><button class="cs cu ar as gr bb bc gs ba df bi b bj bk bl bm dg dh di bx dj bd">Follow</button></div></div></div></div></div></div><div class="qq dp r qr qs y"><a href="https://medium.com/p/b1f6f887677d/responses/show?source=follow_footer--------------------------follow_footer-" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl" rel="noopener"><span class="qt qu ns"><div class="lo qv df r hz aq"><span class="ar">See responses (1)</span></div></span></a></div></div></div><div class="qw r qx y"><div class="n p"><div class="z ab ac ae af ag ah ai"><div class="th r ti"><div class="si nc py r"><h2 class="bi jk tj tk ct">More From Medium</h2></div><div class="dz n oo oh tl tm tn to tp tq tr ts tt tu tv tw tx ty tz"><div class="ua ub uc md ud ue uf mf ug uh ui mh uj uk ul um un uo up uq ur"><div class="ai hn"><div class="r us"><div class="ut uu tl tm tn uv uw to tp tq ux uy tr ts tt uz va tu tv tw vb vc tx ty tz n oh"><div class="ua ub uc md ud ue vd ve ug uh vf vg uj uk vh vi un uo vj vk ur"><div class="vl r vm f"><h4 class="bi ej cb bk bn">More on Docker from ECS Digital</h4></div><div class="br r vn ti"><a class="cg ch at au av aw ax ay az ba ci cj bd be ck cl r" rel="noopener" href="https://medium.com/ecs-digital/amazon-fargate-for-amazon-eks-1ca77146f5d4?source=post_recirc---------0------------------"></a></div></div><div class="ua ub uc md ud ue vd ve ug uh vf vg uj uk vh vi un uo vj vk ur"><div class="br r"><div class="vo ap h vp"><h4 class="bi ej cb bk bn">More on Docker from ECS Digital</h4></div><a rel="noopener" href="https://medium.com/ecs-digital/amazon-fargate-for-amazon-eks-1ca77146f5d4?source=post_recirc---------0------------------"><h3 class="ct q fj vq bj vr vs vt">Amazon Fargate for Amazon EKS</h3></a></div><div class="n o gb"><div class="cm r dv"><div class="o n"><div></div><div class="ai r"><div class="n"><div style="flex: 1 1 0%;"><span class="bi b bj bk bl bm r ct q"><div class="en n o gj"><span class="bi ej cb bk bv gk bu gl gm gn ct"><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/@sunil.tailor?source=post_recirc---------0------------------">Sunil Tailor</a><span> in <a href="https://medium.com/ecs-digital?source=post_recirc---------0------------------" class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener">ECS Digital</a></span></span></div></span></div></div><span class="bi b bj bk bl bm r bn bo"><span class="bi ej cb bk bv gk bu gl gm gn bn"><div><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/ecs-digital/amazon-fargate-for-amazon-eks-1ca77146f5d4?source=post_recirc---------0------------------">Jan 13</a> · 7 min read</div></span></span></div></div></div><div class="n o"><div class="n o"><div class="r cd nk nl nm nn no"><div class=""><button class="ay np nq nr ns nt nu st q nw nx"><svg width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></button></div></div><div class="r ny nz oa ob oc od oe"><div class="of"><h4 class="bi ej cb bk bn">4</h4></div></div></div><div class="vu gh cm ed vv r"></div><div class="he"><div><div class="bx" role="tooltip" aria-hidden="true" aria-describedby="19" aria-labelledby="19"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></div><div class="ua ub uc md ud ue uf mf ug uh ui mh uj uk ul um un uo up uq ur"><div class="ai hn"><div class="r us"><div class="ut uu tl tm tn uv uw to tp tq ux uy tr ts tt uz va tu tv tw vb vc tx ty tz n oh"><div class="ua ub uc md ud ue vd ve ug uh vf vg uj uk vh vi un uo vj vk ur"><div class="vl r vm f"><h4 class="bi ej cb bk bn">Related reads</h4></div><div class="br r vn ti"><a href="https://levelup.gitconnected.com/architecting-a-ci-cd-pipeline-for-container-and-microservice-based-applications-120f4b470681?source=post_recirc---------1------------------" class="cg ch at au av aw ax ay az ba ci cj bd be ck cl r" rel="noopener nofollow"></a></div></div><div class="ua ub uc md ud ue vd ve ug uh vf vg uj uk vh vi un uo vj vk ur"><div class="br r"><div class="vo ap h vp"><h4 class="bi ej cb bk bn">Related reads</h4></div><a href="https://levelup.gitconnected.com/architecting-a-ci-cd-pipeline-for-container-and-microservice-based-applications-120f4b470681?source=post_recirc---------1------------------" rel="noopener nofollow"><h3 class="ct q fj vq bj vr vs vt">Architecting a CI/CD pipeline for container and microservice-based applications</h3></a></div><div class="n o gb"><div class="cm r dv"><div class="o n"><div></div><div class="ai r"><div class="n"><div style="flex: 1 1 0%;"><span class="bi b bj bk bl bm r ct q"><div class="en n o gj"><span class="bi ej cb bk bv gk bu gl gm gn ct"><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/@alokmalakar?source=post_recirc---------1------------------">Alok</a><span> in <a href="https://levelup.gitconnected.com/?source=post_recirc---------1------------------" class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener nofollow">Level Up Coding</a></span></span></div></span></div></div><span class="bi b bj bk bl bm r bn bo"><span class="bi ej cb bk bv gk bu gl gm gn bn"><div><a href="https://levelup.gitconnected.com/architecting-a-ci-cd-pipeline-for-container-and-microservice-based-applications-120f4b470681?source=post_recirc---------1------------------" class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener nofollow">May 7, 2019</a> · 8 min read</div></span></span></div></div></div><div class="n o"><div class="n o"><div class="r cd nk nl nm nn no"><div class=""><button class="ay np nq nr ns nt nu st q nw nx"><svg width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></button></div></div><div class="r ny nz oa ob oc od oe"><div class="of"><h4 class="bi ej cb bk bn">542</h4></div></div></div><div class="vu gh cm ed vv r"></div><div class="he"><div><div class="bx" role="tooltip" aria-hidden="true" aria-describedby="20" aria-labelledby="20"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></div><div class="ua ub uc md ud ue uf mf ug uh ui mh uj uk ul um un uo up uq ur"><div class="ai hn"><div class="r us"><div class="ut uu tl tm tn uv uw to tp tq ux uy tr ts tt uz va tu tv tw vb vc tx ty tz n oh"><div class="ua ub uc md ud ue vd ve ug uh vf vg uj uk vh vi un uo vj vk ur"><div class="vl r vm f"><h4 class="bi ej cb bk bn">Related reads</h4></div><div class="br r vn ti"><a class="cg ch at au av aw ax ay az ba ci cj bd be ck cl r" rel="noopener" href="https://medium.com/better-programming/deploy-a-docker-registry-using-tls-and-htpasswd-56dd57a1215a?source=post_recirc---------2------------------"></a></div></div><div class="ua ub uc md ud ue vd ve ug uh vf vg uj uk vh vi un uo vj vk ur"><div class="br r"><div class="vo ap h vp"><h4 class="bi ej cb bk bn">Related reads</h4></div><a rel="noopener" href="https://medium.com/better-programming/deploy-a-docker-registry-using-tls-and-htpasswd-56dd57a1215a?source=post_recirc---------2------------------"><h3 class="ct q fj vq bj vr vs vt">Deploy a Docker Registry Using Self-Signed Certificates and htpasswd</h3></a></div><div class="n o gb"><div class="cm r dv"><div class="o n"><div></div><div class="ai r"><div class="n"><div style="flex: 1 1 0%;"><span class="bi b bj bk bl bm r ct q"><div class="en n o gj"><span class="bi ej cb bk bv gk bu gl gm gn ct"><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/@lvthillo?source=post_recirc---------2------------------">Lorenz Vanthillo</a><span> in <a href="https://medium.com/better-programming?source=post_recirc---------2------------------" class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener">Better Programming</a></span></span></div></span></div></div><span class="bi b bj bk bl bm r bn bo"><span class="bi ej cb bk bv gk bu gl gm gn bn"><div><a class="cg ch at au av aw ax ay az ba go bd be ck cl" rel="noopener" href="https://medium.com/better-programming/deploy-a-docker-registry-using-tls-and-htpasswd-56dd57a1215a?source=post_recirc---------2------------------">May 23, 2018</a> · 3 min read<span style="padding-left: 4px;"><svg class="star-15px_svg__svgIcon-use" width="15" height="15" viewBox="0 0 15 15" style="margin-top: -2px;"><path d="M7.44 2.32c.03-.1.09-.1.12 0l1.2 3.53a.29.29 0 0 0 .26.2h3.88c.11 0 .13.04.04.1L9.8 8.33a.27.27 0 0 0-.1.29l1.2 3.53c.03.1-.01.13-.1.07l-3.14-2.18a.3.3 0 0 0-.32 0L4.2 12.22c-.1.06-.14.03-.1-.07l1.2-3.53a.27.27 0 0 0-.1-.3L2.06 6.16c-.1-.06-.07-.12.03-.12h3.89a.29.29 0 0 0 .26-.19l1.2-3.52z"></path></svg></span></div></span></span></div></div></div><div class="n o"><div class="n o"><div class="r cd nk nl nm nn no"><div class=""><button class="ay np nq nr ns nt nu st q nw nx"><svg width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></button></div></div><div class="r ny nz oa ob oc od oe"><div class="of"><h4 class="bi ej cb bk bn">149</h4></div></div></div><div class="vu gh cm ed vv r"></div><div class="he"><div><div class="bx" role="tooltip" aria-hidden="true" aria-describedby="21" aria-labelledby="21"><button class="cg ch at au av aw ax ay az ba ci cj bd be ck cl"><svg width="25" height="25" viewBox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="qy r qz ra"><section class="et eu ai di r rb rc rd re rf rg rh ri rj rk rl rm rn ro rp"><div class="rq rr py n gb g"><div class="rs n gb"><div class="rt r ru"><div class="rv r"><a class="cg ch at au av aw ax ay az ba rw rx bd be ry rz" rel="noopener" href="https://medium.com/about?autoplay=1&amp;source=post_page-----b1f6f887677d----------------------"><h4 class="sa sb sc bi jk bj qn sd se r">Discover <!-- -->Medium</h4></a></div><span class="bi b bj bk bl bm r sf sg">Welcome to a place where words matter. On <!-- -->Medium<!-- -->, smart voices and original ideas take center stage - with no ads in sight.<!-- --> <a class="cg ch at au av aw ax ay az ba bd be ry rz sh" rel="noopener" href="https://medium.com/about?autoplay=1&amp;source=post_page-----b1f6f887677d----------------------">Watch</a></span></div><div class="rt r ru"><div class="si r"><a href="https://medium.com/topics?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba rw rx bd be ry rz" rel="noopener"><h4 class="sa sb sc bi jk bj qn sd se r">Make <!-- -->Medium<!-- --> yours</h4></a></div><span class="bi b bj bk bl bm r sf sg">Follow all the topics you care about, and we’ll deliver the best stories for you to your homepage and inbox.<!-- --> <a href="https://medium.com/topics?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba bd be ry rz sh" rel="noopener">Explore</a></span></div><div class="rt r ru"><div class="rv r"><a class="cg ch at au av aw ax ay az ba rw rx bd be ry rz" rel="noopener" href="https://medium.com/membership?source=post_page-----b1f6f887677d----------------------"><h4 class="sa sb sc bi jk bj qn sd se r">Become a member</h4></a></div><span class="bi b bj bk bl bm r sf sg">Get unlimited access to the best stories on <!-- -->Medium<!-- --> — and support writers while you’re at it. Just $5/month.<!-- --> <a class="cg ch at au av aw ax ay az ba bd be ry rz sh" rel="noopener" href="https://medium.com/membership?source=post_page-----b1f6f887677d----------------------">Upgrade</a></span></div></div></div><div class="n ew"><div class="n o gb"><a href="https://medium.com/?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba rw rx bd be ry rz" rel="noopener"><svg height="22" width="112" viewBox="0 0 111.5 22" class="sb"><path d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z"></path></svg></a><span class="bi b bj bk bl bm r sf sg"><div class="sj sk n gb sl al"><h4 class="bi ej jl qn sa"><a class="cg ch at au av aw ax ay az ba go bd be ry rz" rel="noopener" href="https://medium.com/about?autoplay=1&amp;source=post_page-----b1f6f887677d----------------------">About</a></h4><h4 class="bi ej jl qn sa"><a href="https://help.medium.com/?source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba go bd be ry rz" rel="noopener">Help</a></h4><h4 class="bi ej jl qn sa"><a class="cg ch at au av aw ax ay az ba go bd be ry rz" rel="noopener" href="https://medium.com/policy/9db0094a1e0f?source=post_page-----b1f6f887677d----------------------">Legal</a></h4></div></span></div><div class="ap sm sn al"><h4 class="bi ej jl qn sf">Get the Medium app</h4></div><div class="ap sm so al sp"><div class="cq r"><a href="https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&amp;mt=8&amp;ct=post_page&amp;source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba rw rx bd be ry rz" rel="noopener nofollow"><img alt="A button that says &#39;Download on the App Store&#39;, and if clicked it will lead you to the iOS App store" class="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_M2FVPPidy2x386MRAE-EeA.png" width="135" height="41"></a></div><div class="r"><a href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;source=post_page-----b1f6f887677d----------------------" class="cg ch at au av aw ax ay az ba rw rx bd be ry rz" rel="noopener nofollow"><img alt="A button that says &#39;Get it on, Google Play&#39;, and if clicked it will lead you to the Google Play store" class="" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/1_HyH8oIcJvXp7xzu5oF6dTg.png" width="135" height="41"></a></div></div></div></section></div></div></div><script>window.__BUILD_ID__ = "master-20200514-212717-055c8cb45e"</script><script>window.__GRAPHQL_URI__ = "https://medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"config":{"nodeEnv":"production","version":"master-20200514-212717-055c8cb45e","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","lightStep":{"name":"lite-web","host":"collector-medium.lightstep.com","token":"ce5be895bef60919541332990ac9fef2","appVersion":"master-20200514-212717-055c8cb45e"},"algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","datadog":{"clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","context":{"deployment":{"target":"production","tag":"master-20200514-212717-055c8cb45e","commit":"055c8cb45eab6df42b1653c0445381438a517788"}},"datacenter":"us"},"sentry":{"dsn":"https:\u002F\u002F589e367c28ca47b195ce200d1507d18b@sentry.io\u002F1423575","environment":"production"},"isAmp":false,"googleAnalyticsCode":"UA-24232453-2","signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumOwnedAndOperatedCollectionIds":["544c7006046e","bcc38c8f6edf","444d13b52878","8d6b8a439e32","92d2092dc598","1285ba81cada","cb8577c9149e","8ccfed20cbb2","ae2a65f35510","3f6ecf56618","7b6769f2748b","fc8964313712","ef8e90590e66","191186aaafa0","d944778ce714","bdc4052bbdba","88d9857e584e"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"internalLinksPostIds":["0","1","2","3"],"webpMiroImageIds":["1*y7gegIZOYlsnhWFJwIyDJw","1*ByGRQD1zlYXGS4YBYAoLVA","1*orNowUCqCER-BwaAXOZx0A","1*itOsotYFripvvRKY1itrVQ","1*b_LB1ifqWQ2x3JG_m3MJsg","1*AD7jcqVRun0Hhwmg0-Vqfg","1*0kJoJveqoxkYXEmdM2FZ3A","1*pTq8R2lALVUytg_k4y5CpQ","1*1_tSnwIHb_oPsU9vucJijQ","1*EBN0PWXjvaF2gRdk9fCvzA","1*Uxc2_wlnoVQNMQUhQaLVZg","1*ABOw4ARUQ90kwKfXqeVdXA","1*Ok2A1h7LmAtYjWVG9c8IMA","1*Kw1AUMFyy3AGJ1BbTdeyWg","1*2RZldaiJQXadc5zjscYncg","1*hPIJUpxe2QMvOMNcTlnOlQ","1*MZyvxFpPUvfBUfoNvFhRzg","1*2ROzqt2hXcYs6BuKjG2_nQ","1*NO9eMccT-vPrY8nylJ4PVw","2*6cf2Ep3P-r1vCrc-6Bc-vA","1*hVxgUA6kP-PgL5TJjuyePg","1*VGtACZSU6AxT3ugiNr-WGg","0*8dBf1Vy9mkDdcuwQ","1*5ciI2lDFX8sJanIJa6ppnA","1*Hqtfw2Juvf6Zb9uGimLLMg","1*suPSqLiNrJPCUbtdUwLnGw","1*dIANAeHtMxPlVO9awEN0Jw","1*N2KcM3GCLymsKxnSBXyG_g","1*fgNVzsUlPl9tA8ladAT-KA","1*h-La0GVOrPo6SrFpNWQLtw","1*3IPJZVYg-95RkV8H4DRjvA","1*DgnF3PmTVG14Oz_-8BWX_g","1*x_SKDZtUCcWMH9FB092srw","1*oQ4U4pCo7OUPMXXphwqzTg","1*fjC3jxxcmOwXLwqxraNHfw","1*DXy0NEVftDaLKDVG8dS3YQ","1*KbxEajPgdT9GhcWWGG8JmQ","1*e6oTrX0jQU0lPM_0Tt-oYw","1*oQ4U4pCo7OUPMXXphwqzTg"],"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*3sela1OADrJr7dJk_CXaEQ.png","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"performanceTags":[],"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"covidCollectionId":"8a9336e5bb4","sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":["pandemic","epidemic","coronavirus","covid19","co-vid-19","containment","self-care","flatten-the-curve","public-health","virus","public-health-crisis","quarantine","self-quarantine","zika","corona","disease-prevention","wuhan","chinavirus","outbreak","influenza","socialdistancing","social-distance","flu","vaccines","healthcare","medicine","conspiracy-theories","conspiracy","virality","epidemia","pandemia","salud","corona-e-virus","coronavirus-covid19","covid-19","covid-19-symptoms","covid-19-crisis","covid-19-testing","covid-19-treatment","coronavirus-update","coronavirus-diaries"],"COVID_APPLICABLE_TOPIC_NAMES":["coronavirus"],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":["coronavirus","health"],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4"},"debug":{"requestId":"2eceb518-baed-4d5d-ab66-82ffec321f7b","edge":"","originalSpanCarrier":{"ot-tracer-spanid":"19ca0f216991eb17","ot-tracer-traceid":"6dcdca5d17a8bf17","ot-tracer-sampled":"true"}},"session":{"user":{"id":"7a3e31328c38"},"xsrf":"FrAaqDoPJyp5","isSpoofed":false},"stats":{"itemCount":0,"sending":false,"timeout":null,"backup":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedGoogleOneTap":null,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fuse-consul-as-a-load-balancer-with-nginx-b1f6f887677d","host":"medium.com","hostname":"medium.com","referrer":"https:\u002F\u002Fwww.google.com\u002F","susiModal":{"step":null,"operation":"register"},"postRead":false},"client":{"isBot":false,"isCustomDomain":false,"isEu":false,"isNativeMedium":false,"isSafariMobile":false,"inAppBrowserName":"","supportsWebp":true},"multiVote":{"clapsPerPost":{}},"tracing":{}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY.variantFlags.0":{"name":"add_friction_to_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.0.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.0.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.1":{"name":"allow_access","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.1.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.1.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.2":{"name":"allow_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.2.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.2.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.3":{"name":"allow_test_auth","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.3.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.3.valueType":{"__typename":"VariantFlagString","value":"disallow"},"ROOT_QUERY.variantFlags.4":{"name":"assign_default_topic_to_posts","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.4.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.4.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.5":{"name":"available_annual_plan","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.5.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.5.valueType":{"__typename":"VariantFlagString","value":"2c754bcc2995"},"ROOT_QUERY.variantFlags.6":{"name":"available_monthly_plan","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.6.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.6.valueType":{"__typename":"VariantFlagString","value":"60e220181034"},"ROOT_QUERY.variantFlags.7":{"name":"bane_add_user","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.7.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.7.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.8":{"name":"branch_seo_metadata","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.8.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.8.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.9":{"name":"browsable_stream_config_bucket","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.9.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.9.valueType":{"__typename":"VariantFlagString","value":"curated-topics"},"ROOT_QUERY.variantFlags.10":{"name":"coronavirus_topic_recirc","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.10.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.10.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.11":{"name":"covid_19_cdc_banner","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.11.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.11.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.12":{"name":"disable_android_subscription_activity_carousel","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.12.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.12.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.13":{"name":"disable_gosocial_followers_that_you_follow","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.13.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.13.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.14":{"name":"disable_ios_resume_reading_toast","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.14.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.14.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.15":{"name":"disable_ios_subscription_activity_carousel","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.15.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.15.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.16":{"name":"disable_mobile_featured_chunk","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.16.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.16.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.17":{"name":"disable_post_recommended_from_friends_provider","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.17.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.17.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.18":{"name":"enable_android_local_currency","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.18.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.18.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.19":{"name":"enable_annual_renewal_reminder_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.19.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.19.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.20":{"name":"enable_app_flirty_thirty","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.20.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.20.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.21":{"name":"enable_apple_sign_in","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.21.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.21.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.22":{"name":"enable_automated_mission_control_triggers","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.22.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.22.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.23":{"name":"enable_branch_io","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.23.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.23.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.24":{"name":"enable_branding","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.24.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.24.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.25":{"name":"enable_branding_fonts","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.25.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.25.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.26":{"name":"enable_cleansweep_cachev2_reads","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.26.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.26.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.27":{"name":"enable_cleansweep_double_writes","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.27.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.27.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.28":{"name":"enable_confirm_sign_in","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.28.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.28.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.29":{"name":"enable_curation_priority_queue_experiment","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.29.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.29.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.30":{"name":"enable_daily_read_digest_promo","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.30.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.30.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.31":{"name":"enable_dedicated_series_tab_api_ios","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.31.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.31.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.32":{"name":"enable_different_grid","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.32.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.32.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.33":{"name":"enable_digest_feature_logging","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.33.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.33.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.34":{"name":"enable_digest_tagline","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.34.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.34.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.35":{"name":"enable_disregard_trunc_state_for_footer","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.35.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.35.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.36":{"name":"enable_edit_alt_text","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.36.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.36.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.37":{"name":"enable_email_sign_in_captcha","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.37.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.37.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.38":{"name":"enable_embedding_based_diversification","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.38.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.38.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.39":{"name":"enable_ev_mission_email_v3","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.39.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.39.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.40":{"name":"enable_ev_mission_trial_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.40.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.40.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.41":{"name":"enable_expanded_feature_chunk_pool","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.41.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.41.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.42":{"name":"enable_filter_by_resend_rules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.42.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.42.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.43":{"name":"enable_filter_expire_processor","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.43.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.43.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.44":{"name":"enable_first_name_on_paywall","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.44.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.44.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.45":{"name":"enable_footer_app_buttons","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.45.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.45.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.46":{"name":"enable_free_corona_topic","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.46.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.46.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.47":{"name":"enable_global_susi_modal","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.47.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.47.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.48":{"name":"enable_google_one_tap","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.48.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.48.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.49":{"name":"enable_highlander_member_digest","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.49.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.49.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.50":{"name":"enable_ios_post_stats","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.50.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.50.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.51":{"name":"enable_janky_spam_rules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.51.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.51.valueType":{"__typename":"VariantFlagString","value":"users,posts"},"ROOT_QUERY.variantFlags.52":{"name":"enable_json_logs_trained_ranker","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.52.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.52.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.53":{"name":"enable_kafka_events","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.53.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.53.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.54":{"name":"enable_kbfd_rex","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.54.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.54.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.55":{"name":"enable_kbfd_rex_app_highlights","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.55.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.55.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.56":{"name":"enable_kbfd_rex_daily_digest","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.56.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.56.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.57":{"name":"enable_li_open_in_app","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.57.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.57.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.58":{"name":"enable_lite_about_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.58.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.58.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.59":{"name":"enable_lite_notifications","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.59.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.59.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.60":{"name":"enable_lite_post","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.60.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.60.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.61":{"name":"enable_lite_post_cd","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.61.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.61.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.62":{"name":"enable_lite_post_highlights","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.62.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.62.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.63":{"name":"enable_lite_post_highlights_view_only","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.63.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.63.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.64":{"name":"enable_lite_profile","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.64.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.64.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.65":{"name":"enable_lite_pub_header_menu","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.65.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.65.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.66":{"name":"enable_lite_server_upstream_deadlines","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.66.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.66.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.67":{"name":"enable_lite_stories","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.67.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.67.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.68":{"name":"enable_lite_topics","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.68.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.68.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.69":{"name":"enable_lite_unread_notification_count_mutation","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.69.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.69.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.70":{"name":"enable_lo_open_in_app","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.70.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.70.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.71":{"name":"enable_login_code_flow","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.71.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.71.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.72":{"name":"enable_marketing_emails","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.72.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.72.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.73":{"name":"enable_media_resource_try_catch","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.73.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.73.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.74":{"name":"enable_membership_remove_section_a","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.74.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.74.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.75":{"name":"enable_meter_payment_link","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.75.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.75.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.76":{"name":"enable_miro_on_kubernetes","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.76.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.76.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.77":{"name":"enable_ml_rank_modules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.77.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.77.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.78":{"name":"enable_ml_rank_rex_anno","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.78.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.78.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.79":{"name":"enable_more_on_coronavirus","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.79.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.79.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.80":{"name":"enable_mute","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.80.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.80.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.81":{"name":"enable_new_collaborative_filtering_data","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.81.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.81.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.82":{"name":"enable_new_suspended_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.82.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.82.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.83":{"name":"enable_new_three_dot_menu","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.83.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.83.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.84":{"name":"enable_open_in_app_regwall","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.84.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.84.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.85":{"name":"enable_optimizely","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.85.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.85.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.86":{"name":"enable_parsely","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.86.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.86.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.87":{"name":"enable_patronus_on_kubernetes","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.87.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.87.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.88":{"name":"enable_popularity_feature","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.88.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.88.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.89":{"name":"enable_post_import","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.89.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.89.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.90":{"name":"enable_post_page_nav_stickiness_removal","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.90.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.90.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.91":{"name":"enable_post_seo_settings_screen","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.91.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.91.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.92":{"name":"enable_post_settings_screen","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.92.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.92.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.93":{"name":"enable_primary_topic_for_mobile","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.93.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.93.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.94":{"name":"enable_rito_upstream_deadlines","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.94.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.94.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.95":{"name":"enable_rtr_channel","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.95.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.95.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.96":{"name":"enable_save_to_medium","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.96.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.96.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.97":{"name":"enable_sepia_to_olsen","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.97.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.97.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.98":{"name":"enable_starspace","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.98.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.98.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.99":{"name":"enable_starspace_digest_app","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.99.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.99.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.100":{"name":"enable_starspace_ranker_starspace","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.100.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.100.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.101":{"name":"enable_tick_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.101.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.101.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.102":{"name":"enable_ticks_digest_promo","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.102.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.102.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.103":{"name":"enable_tipalti_onboarding","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.103.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.103.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.104":{"name":"enable_topic_lifecycle_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.104.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.104.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.105":{"name":"enable_tribute_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.105.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.105.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.106":{"name":"enable_trumpland_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.106.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.106.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.107":{"name":"enable_utc_fix_on_partner_program_dashboard","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.107.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.107.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.108":{"name":"featured_fc_and_ydr","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.108.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.108.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.109":{"name":"filter_low_scoring_users","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.109.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.109.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.110":{"name":"glyph_embed_commands","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.110.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.110.valueType":{"__typename":"VariantFlagString","value":"control"},"ROOT_QUERY.variantFlags.111":{"name":"glyph_font_set","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.111.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.111.valueType":{"__typename":"VariantFlagString","value":"m2"},"ROOT_QUERY.variantFlags.112":{"name":"google_sign_in_android","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.112.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.112.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.113":{"name":"is_not_medium_subscriber","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.113.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.113.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.114":{"name":"limit_post_referrers","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.114.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.114.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.115":{"name":"make_nav_sticky","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.115.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.115.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.116":{"name":"new_transition_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.116.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.116.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.117":{"name":"pub_sidebar","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.117.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.117.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.118":{"name":"rank_model","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.118.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.118.valueType":{"__typename":"VariantFlagString","value":"default"},"ROOT_QUERY.variantFlags.119":{"name":"remove_post_post_similarity","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.119.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.119.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.120":{"name":"share_post_linkedin","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.120.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.120.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.121":{"name":"sign_up_with_email_button","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.121.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.121.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.122":{"name":"signin_services","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.122.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.122.valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"},"ROOT_QUERY.variantFlags.123":{"name":"signup_services","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.123.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.123.valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"},"ROOT_QUERY.variantFlags.124":{"name":"skip_sign_in_recaptcha","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.124.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.124.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.125":{"name":"sourcing_refactor","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.125.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.125.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.126":{"name":"use_new_admin_topic_backend","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.126.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.126.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.127":{"name":"xgboost_auto_suspend","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.127.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.127.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY":{"variantFlags":[{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.0","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.1","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.2","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.3","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.4","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.5","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.6","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.7","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.8","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.9","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.10","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.11","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.12","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.13","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.14","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.15","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.16","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.17","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.18","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.19","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.20","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.21","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.22","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.23","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.24","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.25","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.26","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.27","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.28","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.29","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.30","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.31","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.32","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.33","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.34","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.35","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.36","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.37","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.38","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.39","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.40","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.41","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.42","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.43","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.44","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.45","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.46","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.47","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.48","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.49","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.50","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.51","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.52","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.53","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.54","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.55","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.56","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.57","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.58","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.59","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.60","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.61","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.62","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.63","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.64","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.65","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.66","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.67","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.68","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.69","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.70","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.71","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.72","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.73","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.74","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.75","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.76","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.77","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.78","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.79","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.80","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.81","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.82","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.83","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.84","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.85","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.86","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.87","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.88","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.89","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.90","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.91","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.92","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.93","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.94","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.95","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.96","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.97","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.98","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.99","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.100","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.101","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.102","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.103","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.104","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.105","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.106","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.107","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.108","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.109","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.110","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.111","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.112","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.113","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.114","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.115","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.116","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.117","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.118","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.119","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.120","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.121","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.122","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.123","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.124","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.125","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.126","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.127","typename":"VariantFlag"}],"viewer":{"type":"id","generated":false,"id":"User:7a3e31328c38","typename":"User"},"meterPost({\"postId\":\"b1f6f887677d\",\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}})":{"type":"id","generated":false,"id":"MeteringInfo:singleton","typename":"MeteringInfo"},"postResult({\"id\":\"b1f6f887677d\"})":{"type":"id","generated":false,"id":"Post:b1f6f887677d","typename":"Post"}},"User:7a3e31328c38":{"id":"7a3e31328c38","username":"sunkanmiadewumi1","name":"Adewumi Sunkanmi","imageId":"1*dmbNkD5D-u45r44go_cf0g.png","mediumMemberAt":0,"hasPastMemberships":false,"isPartnerProgramEnrolled":false,"email":"sunkanmiadewumi1@gmail.com","unverifiedEmail":"","createdAt":1543833363441,"isEligibleToViewNewResponses":false,"isMembershipTrialEligible":true,"__typename":"User"},"MeteringInfo:singleton":{"__typename":"MeteringInfo","postIds":{"type":"json","json":[]},"maxUnlockCount":3,"unlocksRemaining":3},"Post:b1f6f887677d":{"__typename":"Post","id":"b1f6f887677d","mediumUrl":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fuse-consul-as-a-load-balancer-with-nginx-b1f6f887677d","canonicalUrl":"","collection":{"type":"id","generated":false,"id":"Collection:9aaa60a31a10","typename":"Collection"},"content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}})":{"type":"id","generated":true,"id":"$Post:b1f6f887677d.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}})","typename":"PostContent"},"creator":{"type":"id","generated":false,"id":"User:52016011f82a","typename":"User"},"firstPublishedAt":1508933031430,"isLocked":false,"isPublished":true,"layerCake":0,"primaryTopic":null,"title":"Use Consul as a Load Balancer with Nginx","latestPublishedVersion":"ec4d07b8d678","visibility":"PUBLIC","isLimitedState":false,"sequence":null,"pendingCollection":null,"shareKey":null,"statusForCollection":"APPROVED","readingTime":9.824528301886792,"readingList":"READING_LIST_NONE","allowResponses":true,"clapCount":123,"viewerClapCount":0,"voterCount":46,"recommenders":[],"license":"ALL_RIGHTS_RESERVED","tags":[{"type":"id","generated":false,"id":"Tag:hashicorp-consul","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:devops","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:docker","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:tools","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:tutorial","typename":"Tag"}],"topics":[{"type":"id","generated":false,"id":"decb52b64abf","typename":"Topic"}],"postResponses":{"type":"id","generated":true,"id":"$Post:b1f6f887677d.postResponses","typename":"PostResponses"},"responsesCount":1,"collaborators":[],"translationSourcePost":null,"newsletterId":"","inResponseToPostResult":null,"inResponseToMediaResource":null,"lockedSource":"LOCKED_POST_SOURCE_NONE","curationEligibleAt":0,"isDistributionAlertDismissed":false,"audioVersionUrl":"","socialTitle":"","socialDek":"","metaDescription":"Using Docker, Nginx, Registrator and Consul Template, you will explore part of what Consul can do andload-balance the traffic to two Nginx webservers using an Nginx load balancer.","latestPublishedAt":1530033546327,"previewContent":{"type":"id","generated":true,"id":"$Post:b1f6f887677d.previewContent","typename":"PreviewContent"},"previewImage":{"type":"id","generated":false,"id":"ImageMetadata:1*pzSrge2ZrWvEwXPdpEvUwA.png","typename":"ImageMetadata"},"isShortform":false,"seoTitle":"","updatedAt":1530033546327,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","isSuspended":false},"Collection:9aaa60a31a10":{"id":"9aaa60a31a10","isAuroraVisible":false,"domain":null,"googleAnalyticsId":null,"slug":"ecs-digital","customStyleSheet":null,"colorBehavior":"ACCENT_COLOR","favicon":{"type":"id","generated":false,"id":"ImageMetadata:","typename":"ImageMetadata"},"name":"ECS Digital","logo":{"type":"id","generated":false,"id":"ImageMetadata:1*f-XKiuRAmuxnZHQNh85Szg.png","typename":"ImageMetadata"},"__typename":"Collection","avatar":{"type":"id","generated":false,"id":"ImageMetadata:1*d1iZ2errdypdhTpO_h-QXQ.png","typename":"ImageMetadata"},"isAuroraEligible":false,"isEnrolledInHightower":false,"isNewsletterV3Enabled":false,"newsletterV3":null,"creator":{"type":"id","generated":false,"id":"User:964e556b3496","typename":"User"},"viewerIsEditor":false,"navItems":[{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.0","typename":"NavItem"},{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.1","typename":"NavItem"},{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.2","typename":"NavItem"},{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.3","typename":"NavItem"},{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.4","typename":"NavItem"},{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.5","typename":"NavItem"},{"type":"id","generated":true,"id":"Collection:9aaa60a31a10.navItems.6","typename":"NavItem"}],"colorPalette":{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette","typename":"ColorPalette"},"viewerCanEditOwnPosts":false,"viewerCanEditPosts":false,"viewerIsMuting":false,"description":"We transform organisations through #DevOps and #ContinuousDelivery by focusing on #PeopleProcessTools. Organiser of #DevOpsPlayground and #AHODevOps meetups.","viewerIsFollowing":false,"viewerIsSubscribedToLetters":false,"canToggleEmail":true,"isUserSubscribedToCollectionEmails":false,"ampEnabled":false,"twitterUsername":"ECS_Digi","facebookPageId":null,"tagline":"We transform organisations through #DevOps and…"},"ImageMetadata:":{"id":"","__typename":"ImageMetadata"},"ImageMetadata:1*f-XKiuRAmuxnZHQNh85Szg.png":{"id":"1*f-XKiuRAmuxnZHQNh85Szg.png","originalWidth":179,"originalHeight":72,"__typename":"ImageMetadata"},"ImageMetadata:1*d1iZ2errdypdhTpO_h-QXQ.png":{"id":"1*d1iZ2errdypdhTpO_h-QXQ.png","__typename":"ImageMetadata"},"User:964e556b3496":{"id":"964e556b3496","__typename":"User"},"Collection:9aaa60a31a10.navItems.0":{"title":"DevOps","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fdevops\u002Fhome","type":"TOPIC_PAGE","__typename":"NavItem"},"Collection:9aaa60a31a10.navItems.1":{"title":"Testing","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Ftesting\u002Fhome","type":"TOPIC_PAGE","__typename":"NavItem"},"Collection:9aaa60a31a10.navItems.2":{"title":"Tools","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Ftools\u002Fhome","type":"TOPIC_PAGE","__typename":"NavItem"},"Collection:9aaa60a31a10.navItems.3":{"title":"Cloud","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fcloud\u002Fhome","type":"TOPIC_PAGE","__typename":"NavItem"},"Collection:9aaa60a31a10.navItems.4":{"title":"Culture","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Fculture\u002Fhome","type":"TOPIC_PAGE","__typename":"NavItem"},"Collection:9aaa60a31a10.navItems.5":{"title":"Tutorials","url":"https:\u002F\u002Fmedium.com\u002Fecs-digital\u002Ftutorials\u002Fhome","type":"TOPIC_PAGE","__typename":"NavItem"},"Collection:9aaa60a31a10.navItems.6":{"title":"ECS Digital Website","url":"https:\u002F\u002Fwww.ecs-digital.co.uk\u002F","type":"EXTERNAL_LINK_NAV_ITEM","__typename":"NavItem"},"$Collection:9aaa60a31a10.colorPalette":{"tintBackgroundSpectrum":null,"__typename":"ColorPalette","highlightSpectrum":{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum","typename":"ColorSpectrum"},"defaultBackgroundSpectrum":{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum","typename":"ColorSpectrum"}},"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum":{"backgroundColor":"#FFFFFFFF","colorPoints":[{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.0","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.1","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.2","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.3","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.4","typename":"ColorPoint"}],"__typename":"ColorSpectrum"},"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.0":{"color":"#FFFFFFFF","point":0,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.1":{"color":"#FFE9FDF0","point":0.1,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.2":{"color":"#FFE2FAEE","point":0.2,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.3":{"color":"#FFADFFCF","point":0.6,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.highlightSpectrum.colorPoints.4":{"color":"#FF7DFFB3","point":1,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum":{"backgroundColor":"#FFFFFFFF","colorPoints":[{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.0","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.1","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.2","typename":"ColorPoint"},{"type":"id","generated":true,"id":"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.3","typename":"ColorPoint"}],"__typename":"ColorSpectrum"},"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.0":{"color":"#FF02B875","point":0,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.1":{"color":"#FF00AB6B","point":0.1,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.2":{"color":"#FF1C9963","point":0.2,"__typename":"ColorPoint"},"$Collection:9aaa60a31a10.colorPalette.defaultBackgroundSpectrum.colorPoints.3":{"color":"#FF092E20","point":1,"__typename":"ColorPoint"},"$Post:b1f6f887677d.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}})":{"isLockedPreviewOnly":false,"validatedShareKey":"","__typename":"PostContent","bodyModel":{"type":"id","generated":true,"id":"$Post:b1f6f887677d.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}}).bodyModel","typename":"RichText"}},"User:52016011f82a":{"id":"52016011f82a","isSuspended":false,"__typename":"User","allowNotes":true,"name":"Michel Lebeau","isFollowing":false,"username":"micheldlebeau","bio":"DevOps and CD Consultant in London at ECS Digital, more links at https:\u002F\u002Fmicheldlebeau.com","imageId":"1*yVci1FgEH8nXLw8LjDvRAg.png","mediumMemberAt":0,"isBlocking":false,"isMuting":false,"isPartnerProgramEnrolled":false,"twitterScreenName":"micheldlebeau"},"$Post:b1f6f887677d.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}}).bodyModel.sections.0":{"name":"144c","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:b1f6f887677d.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}}).bodyModel":{"sections":[{"type":"id","generated":true,"id":"$Post:b1f6f887677d.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fwww.google.com\u002F\"}}).bodyModel.sections.0","typename":"Section"}],"paragraphs":[{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_0","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_1","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_2","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_3","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_4","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_5","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_6","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_7","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_8","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_9","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_10","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_11","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_12","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_13","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_14","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_15","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_16","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_17","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_18","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_19","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_20","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_21","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_22","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_23","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_24","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_25","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_26","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_27","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_28","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_29","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_30","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_31","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_32","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_33","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_34","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_35","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_36","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_37","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_38","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_39","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_40","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_41","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_42","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_43","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_44","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_45","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_46","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_47","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_48","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_49","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_50","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_51","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_52","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_53","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_54","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_55","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_56","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_57","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_58","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_59","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_60","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_61","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_62","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_63","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_64","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_65","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_66","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_67","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_68","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_69","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_70","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_71","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_72","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_73","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_74","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_75","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_76","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_77","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_78","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_79","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_80","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_81","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_82","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_83","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_84","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_85","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_86","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_87","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_88","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_89","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_90","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_91","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_92","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_93","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_94","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_95","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_96","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_97","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_98","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_99","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_100","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_101","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_102","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_103","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_104","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_105","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_106","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_107","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_108","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_109","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_110","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_111","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_112","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_113","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_114","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_115","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_116","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_117","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_118","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_119","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_120","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_121","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_122","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_123","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_124","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_125","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_126","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_127","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_128","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_129","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_130","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_131","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_132","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_133","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_134","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_135","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_136","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:ec4d07b8d678_137","typename":"Paragraph"}],"__typename":"RichText"},"Paragraph:ec4d07b8d678_0":{"id":"ec4d07b8d678_0","name":"38e8","type":"H3","href":null,"layout":null,"metadata":null,"text":"Use Consul as a Load Balancer with Nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_1":{"id":"ec4d07b8d678_1","name":"63a3","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*a-WTOYRFLAzdJeO9QZhqGA.png","typename":"ImageMetadata"},"text":"Consul’s Logo","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*a-WTOYRFLAzdJeO9QZhqGA.png":{"id":"1*a-WTOYRFLAzdJeO9QZhqGA.png","originalHeight":419,"originalWidth":1017,"focusPercentX":20,"focusPercentY":50,"alt":null,"__typename":"ImageMetadata"},"Paragraph:ec4d07b8d678_2":{"id":"ec4d07b8d678_2","name":"3f1c","type":"P","href":null,"layout":null,"metadata":null,"text":"In this post, we will see what Consul can do in terms of Service Discovery, Health Checking, and see how we can use its Key\u002FValue store. We will create two nginx servers, serving two different pages. These pages will display keys from the K\u002FV store of Consul using Consul Template. We will then dynamically load balance these two servers with a third Nginx server, which will only send traffic to the servers that are online. This will all rely heavily on Docker, and Registrator will be used to automatically (de-)register our services.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_3":{"id":"ec4d07b8d678_3","name":"41e7","type":"P","href":null,"layout":null,"metadata":null,"text":"This blog post is derived from a meetup I presented in London a week ago, which I help run with my company, ECS Digital. This is usually hands-on, and every gets a chance to learn something practical.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_3.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_3.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_3.markups.0":{"type":"A","start":33,"end":39,"href":"https:\u002F\u002Fwww.meetup.com\u002FDevOpsPlayground\u002Fevents\u002F243881875\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_3.markups.1":{"type":"A","start":108,"end":119,"href":"https:\u002F\u002Fwww.ecs-digital.co.uk\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_4":{"id":"ec4d07b8d678_4","name":"17cb","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"DevOps Playground\nInterested in DevOps? Confused about all the concept and tools out there? Our meetup group aims to provide some…www.meetup.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_4.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_4.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_4.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:ec4d07b8d678_4.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:ec4d07b8d678_4.markups.0":{"type":"A","start":0,"end":144,"href":"https:\u002F\u002Fwww.meetup.com\u002FDevOpsPlayground\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_4.markups.1":{"type":"STRONG","start":0,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_4.markups.2":{"type":"EM","start":18,"end":130,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:ec4d07b8d678_4.mixtapeMetadata":{"href":"https:\u002F\u002Fwww.meetup.com\u002FDevOpsPlayground\u002F","thumbnailImageId":"0*OAnb7sHCTJWe3vUM.","__typename":"MixtapeMetadata"},"Paragraph:ec4d07b8d678_5":{"id":"ec4d07b8d678_5","name":"18ba","type":"H3","href":null,"layout":null,"metadata":null,"text":"The theory","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_6":{"id":"ec4d07b8d678_6","name":"c5f4","type":"H4","href":null,"layout":null,"metadata":null,"text":"Consul","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_6.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_6.markups.0":{"type":"A","start":0,"end":6,"href":"http:\u002F\u002Fconsul.io","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_7":{"id":"ec4d07b8d678_7","name":"29d4","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Consul has multiple components, but as a whole, it is a tool for discovering and configuring services in your infrastructure. It provides several key features:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_8":{"id":"ec4d07b8d678_8","name":"184b","type":"BQ","href":null,"layout":null,"metadata":null,"text":"* Service Discovery: Clients of Consul can provide a service, such as api or mysql, and other clients can use Consul to discover providers of a given service. Using either DNS or HTTP, applications can easily find the services they depend upon.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_8.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_8.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_8.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_8.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_8.markups.4","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_8.markups.0":{"type":"CODE","start":70,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_8.markups.1":{"type":"CODE","start":77,"end":82,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_8.markups.2":{"type":"STRONG","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_8.markups.3":{"type":"EM","start":43,"end":50,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_8.markups.4":{"type":"EM","start":120,"end":128,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_9":{"id":"ec4d07b8d678_9","name":"0989","type":"BQ","href":null,"layout":null,"metadata":null,"text":"* Health Checking: Consul clients can provide any number of health checks, either associated with a given service (“is the webserver returning 200 OK”), or with the local node (“is memory utilization below 90%”). This information can be used by an operator to monitor cluster health, and it is used by the service discovery components to route traffic away from unhealthy hosts.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_9.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_9.markups.0":{"type":"STRONG","start":0,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_10":{"id":"ec4d07b8d678_10","name":"ab73","type":"BQ","href":null,"layout":null,"metadata":null,"text":"* KV Store: Applications can make use of Consul’s hierarchical key\u002Fvalue store for any number of purposes, including dynamic configuration, feature flagging, coordination, leader election, and more. The simple HTTP API makes it easy to use.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_10.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_10.markups.0":{"type":"STRONG","start":0,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_11":{"id":"ec4d07b8d678_11","name":"36ca","type":"BQ","href":null,"layout":null,"metadata":null,"text":"* Multi Datacenter: Consul supports multiple datacenters out of the box. This means users of Consul do not have to worry about building additional layers of abstraction to grow to multiple regions.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_11.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_11.markups.0":{"type":"STRONG","start":0,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_12":{"id":"ec4d07b8d678_12","name":"8db1","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Consul is designed to be friendly to both the DevOps community and application developers, making it perfect for modern, elastic infrastructures.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_13":{"id":"ec4d07b8d678_13","name":"d3c1","type":"P","href":null,"layout":null,"metadata":null,"text":"Taken directly from the official documentation, which is worth reading. \nWe will make use of the Service Discovery, Health Checking and KV Store.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_13.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_13.markups.0":{"type":"A","start":0,"end":46,"href":"https:\u002F\u002Fwww.consul.io\u002Fintro\u002Findex.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_14":{"id":"ec4d07b8d678_14","name":"2ea5","type":"H4","href":null,"layout":null,"metadata":null,"text":"Nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_15":{"id":"ec4d07b8d678_15","name":"092d","type":"BQ","href":null,"layout":null,"metadata":null,"text":"NGINX is a free, open-source, high-performance HTTP server and reverse proxy, as well as an IMAP\u002FPOP3 proxy server. NGINX is known for its high performance, stability, rich feature set, simple configuration, and low resource consumption.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_16":{"id":"ec4d07b8d678_16","name":"be17","type":"P","href":null,"layout":null,"metadata":null,"text":"Taken from the official Wiki, we will use two Nginx containers to run as webservers, serving simple HTML pages, and we will run a third Nginx container as a load-balancer, to forward requests to the two webservers, or only the ones that are online.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_16.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_16.markups.0":{"type":"A","start":0,"end":28,"href":"https:\u002F\u002Fwww.nginx.com\u002Fresources\u002Fwiki\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_17":{"id":"ec4d07b8d678_17","name":"e4ff","type":"H4","href":null,"layout":null,"metadata":null,"text":"Consul Template","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_18":{"id":"ec4d07b8d678_18","name":"63de","type":"BQ","href":null,"layout":null,"metadata":null,"text":"This project provides a convenient way to populate values from Consul into the file system using the consul-template daemon.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_18.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_18.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_18.markups.0":{"type":"CODE","start":101,"end":116,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_18.markups.1":{"type":"A","start":63,"end":69,"href":"https:\u002F\u002Fwww.consul.io\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_19":{"id":"ec4d07b8d678_19","name":"fc44","type":"BQ","href":null,"layout":null,"metadata":null,"text":"The daemon consul-template queries a Consul or Vault cluster and updates any number of specified templates on the file system. As an added bonus, it can optionally run arbitrary commands when the update process completes.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_19.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_19.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_19.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_19.markups.0":{"type":"CODE","start":11,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_19.markups.1":{"type":"A","start":37,"end":43,"href":"https:\u002F\u002Fwww.consul.io\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_19.markups.2":{"type":"A","start":47,"end":52,"href":"https:\u002F\u002Fwww.vaultproject.io\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_20":{"id":"ec4d07b8d678_20","name":"b058","type":"P","href":null,"layout":null,"metadata":null,"text":"From the readme, we will use Consul Template to render the static HTML pages that will be served by the two Nginx webservers.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_20.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_20.markups.0":{"type":"A","start":0,"end":15,"href":"https:\u002F\u002Fgithub.com\u002Fhashicorp\u002Fconsul-template","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_21":{"id":"ec4d07b8d678_21","name":"53e5","type":"H4","href":null,"layout":null,"metadata":null,"text":"Registrator","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_22":{"id":"ec4d07b8d678_22","name":"7c03","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Registrator automatically registers and deregisters services for any Docker container by inspecting containers as they come online. Registrator supports pluggable service registries, which currently includes Consul, etcd and SkyDNS 2.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_22.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_22.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_22.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_22.markups.0":{"type":"A","start":208,"end":214,"href":"http:\u002F\u002Fwww.consul.io\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_22.markups.1":{"type":"A","start":216,"end":220,"href":"https:\u002F\u002Fgithub.com\u002Fcoreos\u002Fetcd","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_22.markups.2":{"type":"A","start":225,"end":233,"href":"https:\u002F\u002Fgithub.com\u002Fskynetservices\u002Fskydns\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_23":{"id":"ec4d07b8d678_23","name":"e439","type":"P","href":null,"layout":null,"metadata":null,"text":"From the documentation, made by GliderLabs, a group of devs creating cool and useful tools. Registrator will take care of registering our webserver services as they come online, and de-registering them as they go offline, automatically.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_23.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_23.markups.0":{"type":"A","start":0,"end":22,"href":"http:\u002F\u002Fgliderlabs.github.io\u002Fregistrator\u002Flatest\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_24":{"id":"ec4d07b8d678_24","name":"9007","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*pzSrge2ZrWvEwXPdpEvUwA.png","typename":"ImageMetadata"},"text":"The infrastructure we will be aiming for","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*pzSrge2ZrWvEwXPdpEvUwA.png":{"id":"1*pzSrge2ZrWvEwXPdpEvUwA.png","originalHeight":452,"originalWidth":706,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:ec4d07b8d678_25":{"id":"ec4d07b8d678_25","name":"1903","type":"H3","href":null,"layout":null,"metadata":null,"text":"Where to run this?","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_26":{"id":"ec4d07b8d678_26","name":"5810","type":"P","href":null,"layout":null,"metadata":null,"text":"We ran this in an AWS instance, and this blog post will be based on this fact.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_27":{"id":"ec4d07b8d678_27","name":"feb8","type":"P","href":null,"layout":null,"metadata":null,"text":"We used a small instance, but this will run decently on a micro instance, which is in the free tier. We used Ubuntu 16.04 for the OS, and used the defaults for everything else.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_28":{"id":"ec4d07b8d678_28","name":"3792","type":"P","href":null,"layout":null,"metadata":null,"text":"This can run natively on your laptop, however be aware that for example Docker for Mac has many limitations in terms of networking. Using an AWS instance will give you the easiest experience.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_28.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_28.markups.0":{"type":"A","start":91,"end":130,"href":"https:\u002F\u002Fdocs.docker.com\u002Fdocker-for-mac\u002Fnetworking\u002F#known-limitations-use-cases-and-workarounds","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_29":{"id":"ec4d07b8d678_29","name":"7d5a","type":"H3","href":null,"layout":null,"metadata":null,"text":"Before you start…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_30":{"id":"ec4d07b8d678_30","name":"305d","type":"H4","href":null,"layout":null,"metadata":null,"text":"Install Docker on your AWS instance","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_31":{"id":"ec4d07b8d678_31","name":"2718","type":"P","href":null,"layout":null,"metadata":null,"text":"The first step will be to setup the Docker repository on your machine. You will then be able to install Docker.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_32":{"id":"ec4d07b8d678_32","name":"bc07","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt-get update\nsudo apt-get -y install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    software-properties-common\ncurl -fsSL https:\u002F\u002Fdownload.docker.com\u002Flinux\u002Fubuntu\u002Fgpg | sudo apt-key add - &\u003E\u002Fdev\u002Fnull\nsudo apt-get update\nsudo apt-get install docker-ce","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_32.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_32.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_32.markups.0":{"type":"CODE","start":0,"end":213,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_32.markups.1":{"type":"CODE","start":225,"end":275,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_33":{"id":"ec4d07b8d678_33","name":"6442","type":"H4","href":null,"layout":null,"metadata":null,"text":"Download the images that you will need later on","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_34":{"id":"ec4d07b8d678_34","name":"58a4","type":"P","href":null,"layout":null,"metadata":null,"text":"We will make use of the official Consul and Nginx images, and will use the registrator image from Gliderlabs, so let’s download them ahead of time.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_35":{"id":"ec4d07b8d678_35","name":"2189","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker pull consul:1.0.0\nsudo docker pull nginx:1.13.5\nsudo docker pull gliderlabs\u002Fregistrator","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_36":{"id":"ec4d07b8d678_36","name":"38eb","type":"H4","href":null,"layout":null,"metadata":null,"text":"Download Consul Template","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_37":{"id":"ec4d07b8d678_37","name":"dd99","type":"P","href":null,"layout":null,"metadata":null,"text":"We will use Consul Template to render our templates using keys from Consul’s Key\u002FValue store, so we download Consul Template and install it ahead of time too.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_38":{"id":"ec4d07b8d678_38","name":"b880","type":"PRE","href":null,"layout":null,"metadata":null,"text":"wget https:\u002F\u002Freleases.hashicorp.com\u002Fconsul-template\u002F0.19.3\u002Fconsul-template_0.19.3_linux_amd64.tgz -O \u002Ftmp\u002Fconsul-template.tar.gz\nsudo tar -xvzf \u002Ftmp\u002Fconsul-template.tar.gz -C \u002Fusr\u002Flocal\u002Fbin","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_39":{"id":"ec4d07b8d678_39","name":"c3ed","type":"P","href":null,"layout":null,"metadata":null,"text":"All sorted with the pre-requisites, let’s start.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_40":{"id":"ec4d07b8d678_40","name":"dcf0","type":"H3","href":null,"layout":null,"metadata":null,"text":"Start the Consul Server","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_41":{"id":"ec4d07b8d678_41","name":"f4eb","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker run -d \\\n  --name consul --net=host \\\n  -p 8500:8500 \\\n  -e 'CONSUL_LOCAL_CONFIG={\"skip_leave_on_interrupt\": true, \"ui\": true,  \"dns_config\": { \"allow_stale\": false }}' \\\n  consul:1.0.0 agent -server -bind=\"$(curl -s http:\u002F\u002F169.254.169.254\u002Flatest\u002Fmeta-data\u002Flocal-ipv4)\" -client=0.0.0.0  -bootstrap","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_41.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_41.markups.0":{"type":"CODE","start":0,"end":309,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_42":{"id":"ec4d07b8d678_42","name":"3f49","type":"P","href":null,"layout":null,"metadata":null,"text":"This will start a new container running Consul, and attach it to the port 8500 of your instance. Your Consul service will be bound to the private IP of your AWS instance, and listen to requests coming from anywhere. A Consul cluster composed of a single server will be bootstrapped.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_43":{"id":"ec4d07b8d678_43","name":"0a1c","type":"P","href":null,"layout":null,"metadata":null,"text":"For the detailed explanations:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_44":{"id":"ec4d07b8d678_44","name":"aab1","type":"ULI","href":null,"layout":null,"metadata":null,"text":"docker run: run the docker container","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_44.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_44.markups.0":{"type":"CODE","start":0,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_45":{"id":"ec4d07b8d678_45","name":"0634","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-d: daemon mode","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_45.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_45.markups.0":{"type":"CODE","start":0,"end":2,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_46":{"id":"ec4d07b8d678_46","name":"3750","type":"ULI","href":null,"layout":null,"metadata":null,"text":"--name consul: give a human friendly name to our container","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_46.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_46.markups.0":{"type":"CODE","start":0,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_47":{"id":"ec4d07b8d678_47","name":"5d29","type":"ULI","href":null,"layout":null,"metadata":null,"text":"--net=host: use the host's network, will make it easier for our containers to communicate with each other","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_47.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_47.markups.0":{"type":"CODE","start":0,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_48":{"id":"ec4d07b8d678_48","name":"bc4e","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-p 8500:8500: link the port 8500 of our container with the port 8500 of our host, so that we can access the consul ui of our host from outside","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_48.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_48.markups.0":{"type":"CODE","start":0,"end":12,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_49":{"id":"ec4d07b8d678_49","name":"e6f9","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-e 'CONSUL_LOCAL_CONFIG={\"skip_leave_on_interrupt\": true, \"ui\": true, \"dns_config\": { \"allow_stale\": false }}': pass some configuration to consul","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_49.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_49.markups.0":{"type":"CODE","start":0,"end":110,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_50":{"id":"ec4d07b8d678_50","name":"0863","type":"ULI","href":null,"layout":null,"metadata":null,"text":"consul: we will use the official consul image","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_50.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_50.markups.0":{"type":"CODE","start":0,"end":6,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_51":{"id":"ec4d07b8d678_51","name":"4a83","type":"ULI","href":null,"layout":null,"metadata":null,"text":"agent -server: we then pass options to our image, here we want to run the agent in server mode","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_51.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_51.markups.0":{"type":"CODE","start":0,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_52":{"id":"ec4d07b8d678_52","name":"4734","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-bind=\"$(curl -s http:\u002F\u002F169.254.169.254\u002Flatest\u002Fmeta-data\u002Flocal-ipv4)\": bind the consul server to the private IP of our instance to make it easier for all our containers to talk to each other","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_52.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_52.markups.0":{"type":"CODE","start":0,"end":69,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_53":{"id":"ec4d07b8d678_53","name":"e769","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-client=0.0.0.0: accept connections from anywhere","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_53.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_53.markups.0":{"type":"CODE","start":0,"end":15,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_54":{"id":"ec4d07b8d678_54","name":"47c0","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-bootstrap: let the consul server be the only server","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_54.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_54.markups.0":{"type":"CODE","start":0,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_55":{"id":"ec4d07b8d678_55","name":"2758","type":"H3","href":null,"layout":null,"metadata":null,"text":"Start Registrator","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_56":{"id":"ec4d07b8d678_56","name":"3e77","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker run -d \\\n    --name=registrator \\\n    --net=host \\\n    --volume=\u002Fvar\u002Frun\u002Fdocker.sock:\u002Ftmp\u002Fdocker.sock \\\n    gliderlabs\u002Fregistrator \\\n      consul:\u002F\u002Flocalhost:8500","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_56.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_56.markups.0":{"type":"CODE","start":0,"end":174,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_57":{"id":"ec4d07b8d678_57","name":"ee85","type":"P","href":null,"layout":null,"metadata":null,"text":"This will start a new container running Registrator, with access to the Docker API, and using Consul to register services.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_58":{"id":"ec4d07b8d678_58","name":"ac6d","type":"P","href":null,"layout":null,"metadata":null,"text":"Details:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_59":{"id":"ec4d07b8d678_59","name":"1913","type":"ULI","href":null,"layout":null,"metadata":null,"text":"--volume=\u002Fvar\u002Frun\u002Fdocker.sock:\u002Ftmp\u002Fdocker.sock: Allows Registrator to access Docker API","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_59.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_59.markups.0":{"type":"CODE","start":0,"end":46,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_60":{"id":"ec4d07b8d678_60","name":"0e77","type":"ULI","href":null,"layout":null,"metadata":null,"text":"gliderlabs\u002Fregistrator: using gliderlabs’ registrator","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_60.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_60.markups.0":{"type":"CODE","start":0,"end":22,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_61":{"id":"ec4d07b8d678_61","name":"ecf3","type":"ULI","href":null,"layout":null,"metadata":null,"text":"consul:\u002F\u002Flocalhost:8500: registry URL, in this case Consul","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_61.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_61.markups.0":{"type":"CODE","start":0,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_62":{"id":"ec4d07b8d678_62","name":"870e","type":"H3","href":null,"layout":null,"metadata":null,"text":"Generate your index pages","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_63":{"id":"ec4d07b8d678_63","name":"ae96","type":"H4","href":null,"layout":null,"metadata":null,"text":"Create your templates first","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_64":{"id":"ec4d07b8d678_64","name":"a9c0","type":"PRE","href":null,"layout":null,"metadata":null,"text":"echo \"Server Nginx 1, Name: {{ keyOrDefault \\\"playground\u002Fserver1\\\" \\\"server1 name missing\\\" }}\" \u003E\u003E \u002Ftmp\u002Findex.html.1.template\necho \"Server Nginx 2, Name: {{ keyOrDefault \\\"playground\u002Fserver2\\\" \\\"server2 name missing\\\" }}\" \u003E\u003E \u002Ftmp\u002Findex.html.2.template","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_64.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_64.markups.0":{"type":"CODE","start":0,"end":251,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_65":{"id":"ec4d07b8d678_65","name":"82d2","type":"P","href":null,"layout":null,"metadata":null,"text":"We create two simple HTML pages, {{ keyOrDefault \\\"playground\u002Fserver1\\\" \\\"server1 name missing\\\" }}\": will be replaced by consul-template with the value of the key playground\u002Fserver1, or will be \"server1 name missing\" by default if no key with this name is present.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_65.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_65.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_65.markups.0":{"type":"CODE","start":33,"end":100,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_65.markups.1":{"type":"CODE","start":164,"end":182,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_66":{"id":"ec4d07b8d678_66","name":"274d","type":"H4","href":null,"layout":null,"metadata":null,"text":"Render the templates using Consul Template","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_67":{"id":"ec4d07b8d678_67","name":"0c6e","type":"PRE","href":null,"layout":null,"metadata":null,"text":"nohup consul-template \\\n-template \"\u002Ftmp\u002Findex.html.1.template:\u002Ftmp\u002Findex.html.1:\u002Fbin\u002Fbash -c 'sudo docker restart nginx || true'\" \\\n-template \"\u002Ftmp\u002Findex.html.2.template:\u002Ftmp\u002Findex.html.2:\u002Fbin\u002Fbash -c 'sudo docker restart nginx2 || true'\" &","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_67.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_67.markups.0":{"type":"CODE","start":0,"end":240,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_68":{"id":"ec4d07b8d678_68","name":"6889","type":"P","href":null,"layout":null,"metadata":null,"text":"We run consul-template in the background using nohup and pass our two templates. For each template that we want rendered, we pass three things:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_69":{"id":"ec4d07b8d678_69","name":"87f1","type":"OLI","href":null,"layout":null,"metadata":null,"text":"the input, our template","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_70":{"id":"ec4d07b8d678_70","name":"6808","type":"OLI","href":null,"layout":null,"metadata":null,"text":"the output, the rendered html page","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_71":{"id":"ec4d07b8d678_71","name":"2f2b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"optionally a command that should be run every time one of the keys change","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_72":{"id":"ec4d07b8d678_72","name":"6c0c","type":"P","href":null,"layout":null,"metadata":null,"text":"Here we render our templates into index.html.1 and index.html.2 to keep track of them easily, and we indicate that the containers that will be linked to them should be restarted if they are re-rendered. This will allow the page to be refreshed easily in the container. We add || true as our container isn’t running yet, so restarting it is not going to work, but we want consul-template to keep on running nonetheless .","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_72.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_72.markups.0":{"type":"CODE","start":276,"end":283,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_73":{"id":"ec4d07b8d678_73","name":"22f3","type":"H4","href":null,"layout":null,"metadata":null,"text":"Look at your rendered index pages","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_74":{"id":"ec4d07b8d678_74","name":"0bd7","type":"PRE","href":null,"layout":null,"metadata":null,"text":"cat \u002Ftmp\u002Findex.html.1\ncat \u002Ftmp\u002Findex.html.2","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_74.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_74.markups.0":{"type":"CODE","start":0,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_75":{"id":"ec4d07b8d678_75","name":"9d58","type":"P","href":null,"layout":null,"metadata":null,"text":"As you can see, the pages have been rendered by consul-template, but they are using the defaults that you provided in the templates. You will create the keys in a moment.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_76":{"id":"ec4d07b8d678_76","name":"1c90","type":"H3","href":null,"layout":null,"metadata":null,"text":"Start your Nginx web servers","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_77":{"id":"ec4d07b8d678_77","name":"56a6","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker run -d -P --name=nginx -v \u002Ftmp\u002Findex.html.1:\u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\u002Findex.html -e \"SERVICE_NAME=webserver\" nginx:1.13.5\nsudo docker run -d -P --name=nginx2 -v \u002Ftmp\u002Findex.html.2:\u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\u002Findex.html -e \"SERVICE_NAME=webserver\" nginx:1.13.5","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_77.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_77.markups.0":{"type":"CODE","start":0,"end":260,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_78":{"id":"ec4d07b8d678_78","name":"5557","type":"P","href":null,"layout":null,"metadata":null,"text":"Here we create two containers running nginx, and we give them a service name “webserver” for Registrator.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_79":{"id":"ec4d07b8d678_79","name":"9c4a","type":"P","href":null,"layout":null,"metadata":null,"text":"Details:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_80":{"id":"ec4d07b8d678_80","name":"149e","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-P: make any ports used in the container available on the host, but let Docker handle it","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_80.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_80.markups.0":{"type":"CODE","start":0,"end":2,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_81":{"id":"ec4d07b8d678_81","name":"3209","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-v \u002Ftmp\u002Findex.html.1:-v \u002Ftmp\u002Findex.html.1:\u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\u002Findex.html: mount the \u002Ftmp\u002Findex.html.1 file on our host as \u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\u002Findex.html in the container, which is the page that will be served by default as the root of the webserver","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_81.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_81.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_81.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_81.markups.0":{"type":"CODE","start":0,"end":74,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_81.markups.1":{"type":"CODE","start":86,"end":103,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_81.markups.2":{"type":"CODE","start":124,"end":156,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_82":{"id":"ec4d07b8d678_82","name":"51d7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"-e \"SERVICE_NAME=webserver\": let registrator know that this container is running the service webserver, and it will automatically register it with Consul","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_82.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_82.markups.0":{"type":"CODE","start":0,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_83":{"id":"ec4d07b8d678_83","name":"570c","type":"ULI","href":null,"layout":null,"metadata":null,"text":"nginx:1.13.5: use the official nginx image version 1.13.5","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_83.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_83.markups.0":{"type":"CODE","start":0,"end":12,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_84":{"id":"ec4d07b8d678_84","name":"8146","type":"H4","href":null,"layout":null,"metadata":null,"text":"Query your new nginx servers","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_85":{"id":"ec4d07b8d678_85","name":"129d","type":"P","href":null,"layout":null,"metadata":null,"text":"Get the ports on which they are accessible:\nsudo docker ps -f name=nginx","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_85.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_85.markups.0":{"type":"CODE","start":44,"end":72,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_86":{"id":"ec4d07b8d678_86","name":"e1d5","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*mCvE5hFPsOqmDQfgzl0Now.png","typename":"ImageMetadata"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*mCvE5hFPsOqmDQfgzl0Now.png":{"id":"1*mCvE5hFPsOqmDQfgzl0Now.png","originalHeight":150,"originalWidth":2444,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:ec4d07b8d678_87":{"id":"ec4d07b8d678_87","name":"8f36","type":"P","href":null,"layout":null,"metadata":null,"text":"This will display your two new nginx containers, and see the port mapping as seen below, where nginx and nginx2 are respectively running on the ports 32768 and 32769.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_87.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_87.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_87.markups.0":{"type":"CODE","start":150,"end":155,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_87.markups.1":{"type":"CODE","start":160,"end":165,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_88":{"id":"ec4d07b8d678_88","name":"6395","type":"P","href":null,"layout":null,"metadata":null,"text":"You should now be able to query the servers on their respective ports, and see their content:\ncurl localhost:32768","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_88.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_88.markups.0":{"type":"CODE","start":94,"end":114,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_89":{"id":"ec4d07b8d678_89","name":"6dab","type":"H4","href":null,"layout":null,"metadata":null,"text":"Create the keys\u002Fvalues in Consul","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_90":{"id":"ec4d07b8d678_90","name":"d729","type":"P","href":null,"layout":null,"metadata":null,"text":"Consul ships with a UI which we activated when we created the Consul server, so let’s use it to create the keys that our templates are looking for.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_91":{"id":"ec4d07b8d678_91","name":"365d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Go to http:\u002F\u002F\u003Cpublic IP\u003E:8500\u002Fui\u002F, with \u003Cpublic IP\u003E being the public IP of your instance.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_91.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_91.markups.0":{"type":"CODE","start":6,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_92":{"id":"ec4d07b8d678_92","name":"49d7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"In the top menu, click on the KEY\u002FVALUE menu item.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_93":{"id":"ec4d07b8d678_93","name":"be58","type":"OLI","href":null,"layout":null,"metadata":null,"text":"In the Create Key box, add the playground\u002Fserver1 key and set its value to the name you want to give to your first server","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_93.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_93.markups.0":{"type":"CODE","start":31,"end":49,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_94":{"id":"ec4d07b8d678_94","name":"4cf3","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Click the Create button","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_95":{"id":"ec4d07b8d678_95","name":"1dc4","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Repeat steps 2 to 4 for the key playground\u002Fserver2","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_95.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_95.markups.0":{"type":"CODE","start":32,"end":50,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_96":{"id":"ec4d07b8d678_96","name":"0c4b","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*cAPpiAvXifrXKl33EgCe7w.png","typename":"ImageMetadata"},"text":"Consul UI with the two keys created","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*cAPpiAvXifrXKl33EgCe7w.png":{"id":"1*cAPpiAvXifrXKl33EgCe7w.png","originalHeight":1072,"originalWidth":2058,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:ec4d07b8d678_97":{"id":"ec4d07b8d678_97","name":"1a24","type":"H4","href":null,"layout":null,"metadata":null,"text":"Query the servers again","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_98":{"id":"ec4d07b8d678_98","name":"b7da","type":"P","href":null,"layout":null,"metadata":null,"text":"The port will now have changed, so run sudo docker ps -f name=nginx again to see which ports are in use now.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_98.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_98.markups.0":{"type":"CODE","start":39,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_99":{"id":"ec4d07b8d678_99","name":"e090","type":"P","href":null,"layout":null,"metadata":null,"text":"curl localhost:32770 and you should see your keys working! You can change the values of the keys and see the result changing immediately.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_99.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_99.markups.0":{"type":"CODE","start":0,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_100":{"id":"ec4d07b8d678_100","name":"d19f","type":"H3","href":null,"layout":null,"metadata":null,"text":"Setup the Nginx Load Balancer","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_101":{"id":"ec4d07b8d678_101","name":"d375","type":"H4","href":null,"layout":null,"metadata":null,"text":"Create the nginx.conf template","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_102":{"id":"ec4d07b8d678_102","name":"9f9b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"cat \u003C\u003CEOT \u003E\u003E \u002Ftmp\u002Fnginx.conf.template\nupstream app {\n  {{range service \"webserver\"}}server {{.Address}}:{{.Port}} max_fails=3 fail_timeout=60 weight=1;\n  {{else}}server 127.0.0.1:65535; # force a 502{{end}}\n}\n\nserver {\n  listen 80 default_server;\n  resolver 172.16.0.23;\n  set \\$upstream_endpoint http:\u002F\u002Fapp;\n\n  location \u002F {\n    proxy_pass \\$upstream_endpoint;\n    proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;\n    proxy_set_header Host \\$host;\n    proxy_set_header X-Real-IP \\$remote_addr;\n  }\n}\nEOT","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_102.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_102.markups.0":{"type":"CODE","start":0,"end":516,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_103":{"id":"ec4d07b8d678_103","name":"df08","type":"P","href":null,"layout":null,"metadata":null,"text":"We create a new template which is going to loop over all our services called “webserver” and add them to the list of servers in the upstream of our load balancer, and we then send the traffic to this upstream.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_104":{"id":"ec4d07b8d678_104","name":"426a","type":"P","href":null,"layout":null,"metadata":null,"text":"Here is what happens in details:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_105":{"id":"ec4d07b8d678_105","name":"5243","type":"ULI","href":null,"layout":null,"metadata":null,"text":"cat \u003C\u003CEOT \u003E\u003E \u002Ftmp\u002Fnginx.conf.template: will append everything that comes after this line and before the text EOT to the file \u002Ftmp\u002Fnginx.conf.template","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_105.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_105.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_105.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_105.markups.0":{"type":"CODE","start":0,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_105.markups.1":{"type":"CODE","start":109,"end":112,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_105.markups.2":{"type":"CODE","start":125,"end":149,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_106":{"id":"ec4d07b8d678_106","name":"b86b","type":"ULI","href":null,"layout":null,"metadata":null,"text":"upstream app { ... }: set the list of servers that can handle requests","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_106.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_106.markups.0":{"type":"CODE","start":0,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_107":{"id":"ec4d07b8d678_107","name":"c0c7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"{{range service \"webserver\"}}server {{.Address}}:{{.Port}} max_fails=3 fail_timeout=60 weight=1;: loop over all our services \"webserver\", effectively our two nginx webservers, and add their address then port to the template","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_107.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_107.markups.0":{"type":"CODE","start":0,"end":96,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_108":{"id":"ec4d07b8d678_108","name":"715a","type":"ULI","href":null,"layout":null,"metadata":null,"text":"{{else}}server 127.0.0.1:65535; # force a 502{{end}}: if there is no service called webserver, then our list will be empty, so we do this little trick in order to return a 502 to the user","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_108.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_108.markups.0":{"type":"CODE","start":0,"end":52,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_109":{"id":"ec4d07b8d678_109","name":"f487","type":"ULI","href":null,"layout":null,"metadata":null,"text":"server { ... }: configure our server","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_109.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_109.markups.0":{"type":"CODE","start":0,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_110":{"id":"ec4d07b8d678_110","name":"b059","type":"ULI","href":null,"layout":null,"metadata":null,"text":"listen 80 default_server;: listen on the port 80","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_110.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_110.markups.0":{"type":"CODE","start":0,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_111":{"id":"ec4d07b8d678_111","name":"70f4","type":"ULI","href":null,"layout":null,"metadata":null,"text":"resolver 172.16.0.23;: set the DNS to be the one from AWS, this is needed for dynamic load balancing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_111.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_111.markups.0":{"type":"CODE","start":0,"end":21,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_112":{"id":"ec4d07b8d678_112","name":"76dd","type":"ULI","href":null,"layout":null,"metadata":null,"text":"set \\$upstream_endpoint http:\u002F\u002Fapp;: we escape the $ here so that $upstream_endpoint isn't interpreted by bash, and we let nginx know that the upstream endpoint is http:\u002F\u002Fapp, with app being one of the servers defined previously","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_112.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_112.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_112.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_112.markups.0":{"type":"CODE","start":0,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_112.markups.1":{"type":"CODE","start":66,"end":84,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_112.markups.2":{"type":"A","start":164,"end":174,"href":"http:\u002F\u002Fapp\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_113":{"id":"ec4d07b8d678_113","name":"ea3f","type":"ULI","href":null,"layout":null,"metadata":null,"text":"location \u002F { ... }: this block takes care of proxying the details of the requests when the root page is called","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_113.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_113.markups.0":{"type":"CODE","start":0,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_114":{"id":"ec4d07b8d678_114","name":"69fa","type":"H4","href":null,"layout":null,"metadata":null,"text":"Render the nginx.conf file","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_115":{"id":"ec4d07b8d678_115","name":"5786","type":"PRE","href":null,"layout":null,"metadata":null,"text":"nohup consul-template -template \"\u002Ftmp\u002Fnginx.conf.template:\u002Ftmp\u002Fnginx.conf:\u002Fbin\u002Fbash -c 'sudo docker restart nginx-lb || true'\" &","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_115.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_115.markups.0":{"type":"CODE","start":0,"end":128,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_116":{"id":"ec4d07b8d678_116","name":"3e3d","type":"P","href":null,"layout":null,"metadata":null,"text":"We run consul-template again, taking our template as an input, and generating nginx.conf as an output, and every time it will change, the nginx-lb container, which will contain the nginx load balancer, will be restarted, so that the new configuration can be used.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_117":{"id":"ec4d07b8d678_117","name":"341c","type":"H4","href":null,"layout":null,"metadata":null,"text":"Output the content of nginx.conf","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_118":{"id":"ec4d07b8d678_118","name":"495f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"cat \u002Ftmp\u002Fnginx.conf","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_118.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_118.markups.0":{"type":"CODE","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_119":{"id":"ec4d07b8d678_119","name":"39c7","type":"P","href":null,"layout":null,"metadata":null,"text":"You can see the content of nginx.conf and see that it was rendered with the two currently running webservers in the upstream servers.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_120":{"id":"ec4d07b8d678_120","name":"f8a1","type":"H4","href":null,"layout":null,"metadata":null,"text":"Test the template","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_121":{"id":"ec4d07b8d678_121","name":"3c08","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker stop nginx2","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_121.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_121.markups.0":{"type":"CODE","start":0,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_122":{"id":"ec4d07b8d678_122","name":"5c21","type":"P","href":null,"layout":null,"metadata":null,"text":"For fun, you can stop the nginx2 container, then see that the configuration file will have changed.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_123":{"id":"ec4d07b8d678_123","name":"125f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"cat \u002Ftmp\u002Fnginx.conf","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_123.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_123.markups.0":{"type":"CODE","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_124":{"id":"ec4d07b8d678_124","name":"0322","type":"P","href":null,"layout":null,"metadata":null,"text":"You can then start the container again","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_125":{"id":"ec4d07b8d678_125","name":"5c2d","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker start nginx2","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_125.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_125.markups.0":{"type":"CODE","start":5,"end":24,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_126":{"id":"ec4d07b8d678_126","name":"179d","type":"P","href":null,"layout":null,"metadata":null,"text":"And see the content of nginx.conf once again","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_127":{"id":"ec4d07b8d678_127","name":"857c","type":"PRE","href":null,"layout":null,"metadata":null,"text":"cat \u002Ftmp\u002Fnginx.conf","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_127.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_127.markups.0":{"type":"CODE","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_128":{"id":"ec4d07b8d678_128","name":"7e8b","type":"H3","href":null,"layout":null,"metadata":null,"text":"Start the load balancer","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_129":{"id":"ec4d07b8d678_129","name":"0ab9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo docker run -p 80:80 --name nginx-lb \\\n  -v \u002Ftmp\u002Fnginx.conf:\u002Fetc\u002Fnginx\u002Fconf.d\u002Fdefault.conf \\\n  -e \"SERVICE_TAGS=loadbalancer\" -d \\\n  nginx:1.13.5","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_129.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_129.markups.0":{"type":"CODE","start":0,"end":149,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_130":{"id":"ec4d07b8d678_130","name":"eaf2","type":"P","href":null,"layout":null,"metadata":null,"text":"You can now type your public IP (the one you were given on paper) in your browser and see your page. Here are a few things that you can try:","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_131":{"id":"ec4d07b8d678_131","name":"ccbe","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Refresh several times, you will see the two pages alternate","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_132":{"id":"ec4d07b8d678_132","name":"2dd7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Change your key values in Consul UI, notice how the text changes in your browser","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_133":{"id":"ec4d07b8d678_133","name":"0d60","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Shutdown nginx or nginx2 (or even both!) and see what happens when you refresh your browser. (hint: sudo docker stop nginx, sudo docker start nginx...)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_133.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_133.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_133.markups.0":{"type":"CODE","start":100,"end":122,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_133.markups.1":{"type":"CODE","start":124,"end":147,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:ec4d07b8d678_134":{"id":"ec4d07b8d678_134","name":"6bd3","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Change your index templates, notice what happens. Can you figure out why?","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_135":{"id":"ec4d07b8d678_135","name":"8b50","type":"H3","href":null,"layout":null,"metadata":null,"text":"Author’s notes","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_136":{"id":"ec4d07b8d678_136","name":"1cc3","type":"P","href":null,"layout":null,"metadata":null,"text":"This a showcase of what sort of things can be done using Consul, not a production use-case. I encourage you to read through the documentation and other use cases as it can do much more.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_137":{"id":"ec4d07b8d678_137","name":"0aaa","type":"P","href":null,"layout":null,"metadata":null,"text":"I work as a consultant for ECS Digital in London mainly with Puppet, HashiCorp, Jenkins and automation in general. Get in touch if you liked what you read, or would like to learn more about our work.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:ec4d07b8d678_137.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:ec4d07b8d678_137.markups.0":{"type":"A","start":27,"end":38,"href":"https:\u002F\u002Fwww.ecs-digital.co.uk\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Tag:hashicorp-consul":{"id":"hashicorp-consul","displayTitle":"Hashicorp Consul","__typename":"Tag"},"Tag:devops":{"id":"devops","displayTitle":"DevOps","__typename":"Tag"},"Tag:docker":{"id":"docker","displayTitle":"Docker","__typename":"Tag"},"Tag:tools":{"id":"tools","displayTitle":"Tools","__typename":"Tag"},"Tag:tutorial":{"id":"tutorial","displayTitle":"Tutorial","__typename":"Tag"},"decb52b64abf":{"topicId":"decb52b64abf","name":"Programming","__typename":"Topic","slug":"programming"},"$Post:b1f6f887677d.postResponses":{"count":1,"__typename":"PostResponses","responsesConnection({\"paging\":{\"limit\":10}})":{"type":"id","generated":true,"id":"$Post:b1f6f887677d.postResponses.responsesConnection({\"paging\":{\"limit\":10}})","typename":"StreamConnection"}},"$Post:b1f6f887677d.previewContent":{"subtitle":"In this post, we will see what Consul can do in terms of Service Discovery, Health Checking, and see how we can use its Key\u002FValue store.","__typename":"PreviewContent"},"$Post:b1f6f887677d.postResponses.responsesConnection({\"paging\":{\"limit\":10}})":{"pagingInfo":null,"stream":[],"__typename":"StreamConnection"}}</script><script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/manifest.415895ab.js.download"></script><script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/vendors_main.09ac4b3e.chunk.js.download"></script><script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/main.2d0cb0b1.chunk.js.download"></script><script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/vendors_instrumentation.d7114bfc.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/instrumentation.d66f82e4.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/reporting.49324504.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/vendors_AMPPost_CollectionHomepage_CollectionHomepagePreview_CollectionNewShortformEditor_Collection_37c9fa1e.77e6fe9c.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/vendors_AMPPost_DebugCachedPost_Post_SequencePost_Series.0bf77567.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/AMPPost_CollectionHomepage_CollectionHomepagePreview_CollectionNewShortformEditor_CollectionPostShor_3fa3f642.65358959.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/AMPPost_CollectionHomepage_CollectionHomepagePreview_DebugCachedPost_PackageBuilder_Post_PostSetting_8e568ca5.31dbaee5.chunk.js.download"></script>
<script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/Post.7512856d.chunk.js.download"></script><script>window.main();</script><script src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/p.js.download" async="" id="parsely-cf"></script><iframe src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/a16180790160.html" hidden="" tabindex="-1" title="Optimizely Internal Frame" height="0" width="0" style="display: none;"></iframe></body><div id="coFrameDiv" style="height:0px;display:none;"><iframe id="coToolbarFrame" src="./Use Consul as a Load Balancer with Nginx - ECS Digital - Medium_files/placeholder.html" style="height: 0px; width: 100%; display: none;"></iframe></div></html>